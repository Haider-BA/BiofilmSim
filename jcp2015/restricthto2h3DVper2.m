function r2h=restricthto2h3DVper2(rh)

[Em,En,Ep]=size(rh);
% p=log2(size1(1)-1);
pm=(Em+1)/2;
pn=(En+1)/2;
pp=(Ep+1)/2;
r2h=rh(1:2:Em,1:2:En,1:2:Ep);
% rh=[rh,rh(:,2)];
Emm=Em-1;
Emmm=Em-2;
Emmmm=Em-3;
Enm=En-1;
Enmm=En-2;
Enmmm=En-3;
Epm=Ep-1;
Epmm=Ep-2;
Epmmm=Ep-3;
% Enp=En+1;



r2h(2:pm-1,2:pn-1,2:pp-1)=(rh(2:2:Emmmm,2:2:Enmmm,4:2:Epm)+rh(4:2:Emm,2:2:Enmmm,4:2:Epm)+...
    rh(2:2:Emmmm,4:2:Enm,4:2:Epm)+rh(4:2:Emm,4:2:Enm,4:2:Epm)+...
    rh(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm)+rh(4:2:Emm,2:2:Enmmm,2:2:Epmmm)+...
    rh(2:2:Emmmm,4:2:Enm,2:2:Epmmm)+rh(4:2:Emm,4:2:Enm,2:2:Epmmm))/64+...
    (rh(2:2:Emmmm,2:2:Enmmm,3:2:Epmm)+rh(2:2:Emmmm,4:2:Enm,3:2:Epmm)+...
    rh(4:2:Emm,2:2:Enmmm,3:2:Epmm)+rh(4:2:Emm,4:2:Enm,3:2:Epmm)+rh(4:2:Emm,3:2:Enmm,4:2:Epm)+...
    rh(3:2:Emmm,4:2:Enm,4:2:Epm)+rh(2:2:Emmmm,3:2:Enmm,4:2:Epm)+rh(3:2:Emmm,2:2:Enmmm,4:2:Epm)+...
    rh(4:2:Emm,3:2:Enmm,2:2:Epmmm)+rh(3:2:Emmm,4:2:Enm,2:2:Epmmm)+...
    rh(2:2:Emmmm,3:2:Enmm,2:2:Epmmm)+rh(3:2:Emmm,2:2:Enmmm,2:2:Epmmm))/32+...
    (rh(4:2:Emm,3:2:Enmm,3:2:Epmm)+rh(2:2:Emmmm,3:2:Enmm,3:2:Epmm)+...
    rh(3:2:Emmm,2:2:Enmmm,3:2:Epmm)+rh(3:2:Emmm,4:2:Enm,3:2:Epmm)+rh(3:2:Emmm,3:2:Enmm,4:2:Epm)+...
    rh(3:2:Emmm,3:2:Enmm,2:2:Epmmm))/16+rh(3:2:Emmm,3:2:Enmm,3:2:Epmm)/8;


r2h(2:pm-1,2:pn-1,pp)=(rh(2:2:Emmmm,2:2:Enmmm,2)+rh(4:2:Emm,2:2:Enmmm,2)+...
    rh(2:2:Emmmm,4:2:Enm,2)+rh(4:2:Emm,4:2:Enm,2)+...
    rh(2:2:Emmmm,2:2:Enmmm,Epm)+rh(4:2:Emm,2:2:Enmmm,Epm)+...
    rh(2:2:Emmmm,4:2:Enm,Epm)+rh(4:2:Emm,4:2:Enm,Epm))/64+...
    (rh(2:2:Emmmm,2:2:Enmmm,Ep)+rh(2:2:Emmmm,4:2:Enm,Ep)+...
    rh(4:2:Emm,2:2:Enmmm,Ep)+rh(4:2:Emm,4:2:Enm,Ep)+rh(4:2:Emm,3:2:Enmm,2)+...
    rh(3:2:Emmm,4:2:Enm,2)+rh(2:2:Emmmm,3:2:Enmm,2)+rh(3:2:Emmm,2:2:Enmmm,2)+...
    rh(4:2:Emm,3:2:Enmm,Epm)+rh(3:2:Emmm,4:2:Enm,Epm)+...
    rh(2:2:Emmmm,3:2:Enmm,Epm)+rh(3:2:Emmm,2:2:Enmmm,Epm))/32+...
    (rh(4:2:Emm,3:2:Enmm,Ep)+rh(2:2:Emmmm,3:2:Enmm,Ep)+...
    rh(3:2:Emmm,2:2:Enmmm,Ep)+rh(3:2:Emmm,4:2:Enm,Ep)+rh(3:2:Emmm,3:2:Enmm,2)+...
    rh(3:2:Emmm,3:2:Enmm,Epm))/16+rh(3:2:Emmm,3:2:Enmm,Ep)/8;
r2h(2:pm-1,2:pn-1,1)=r2h(2:pm-1,2:pn-1,pp);

r2h(2:pm-1,pn,2:pp-1)=(rh(2:2:Emmmm,Enm,4:2:Epm)+rh(4:2:Emm,Enm,4:2:Epm)+...
    rh(2:2:Emmmm,2,4:2:Epm)+rh(4:2:Emm,2,4:2:Epm)+...
    rh(2:2:Emmmm,Enm,2:2:Epmmm)+rh(4:2:Emm,Enm,2:2:Epmmm)+...
    rh(2:2:Emmmm,2,2:2:Epmmm)+rh(4:2:Emm,2,2:2:Epmmm))/64+...
    (rh(2:2:Emmmm,Enm,3:2:Epmm)+rh(2:2:Emmmm,2,3:2:Epmm)+...
     rh(4:2:Emm,Enm,3:2:Epmm)+rh(4:2:Emm,2,3:2:Epmm)+rh(4:2:Emm,En,4:2:Epm)+...
    rh(3:2:Emmm,2,4:2:Epm)+rh(2:2:Emmmm,En,4:2:Epm)+rh(3:2:Emmm,Enm,4:2:Epm)+...
    rh(4:2:Emm,En,2:2:Epmmm)+rh(3:2:Emmm,2,2:2:Epmmm)+...
    rh(2:2:Emmmm,En,2:2:Epmmm)+rh(3:2:Emmm,Enm,2:2:Epmmm))/32+...
    (rh(4:2:Emm,En,3:2:Epmm)+rh(2:2:Emmmm,En,3:2:Epmm)+...
    rh(3:2:Emmm,Enm,3:2:Epmm)+rh(3:2:Emmm,2,3:2:Epmm)+rh(3:2:Emmm,En,4:2:Epm)+...
    rh(3:2:Emmm,En,2:2:Epmmm))/16+rh(3:2:Emmm,En,3:2:Epmm)/8;
r2h(2:pm-1,1,2:pp-1)=r2h(2:pm-1,pn,2:pp-1);

r2h(2:pm-1,pn,pp)=(rh(2:2:Emmmm,Enm,2)+rh(4:2:Emm,Enm,2)+...
    rh(2:2:Emmmm,2,2)+rh(4:2:Emm,2,2)+...
    rh(2:2:Emmmm,Enm,Epm)+rh(4:2:Emm,Enm,Epm)+...
    rh(2:2:Emmmm,2,Epm)+rh(4:2:Emm,2,Epm))/64+...
    (rh(2:2:Emmmm,Enm,Ep)+rh(2:2:Emmmm,2,Ep)+...
     rh(4:2:Emm,Enm,Ep)+rh(4:2:Emm,2,Ep)+rh(4:2:Emm,En,2)+...
    rh(3:2:Emmm,2,2)+rh(2:2:Emmmm,En,2)+rh(3:2:Emmm,Enm,2)+...
    rh(4:2:Emm,En,Epm)+rh(3:2:Emmm,2,Epm)+...
    rh(2:2:Emmmm,En,Epm)+rh(3:2:Emmm,Enm,Epm))/32+...
    (rh(4:2:Emm,En,Ep)+rh(2:2:Emmmm,En,Ep)+...
    rh(3:2:Emmm,Enm,Ep)+rh(3:2:Emmm,2,Ep)+rh(3:2:Emmm,En,2)+...
    rh(3:2:Emmm,En,Epm))/16+rh(3:2:Emmm,En,Ep)/8;
r2h(2:pm-1,pn,1)=r2h(2:pm-1,pn,pp);
r2h(2:pm-1,1,pp)=r2h(2:pm-1,pn,pp);
r2h(2:pm-1,1,1)=r2h(2:pm-1,pn,pp);



% r2h(2:pm-1,2:pn-1,1)=(rh(2:2:Emmmm,2:2:Enmmm,Epm)+rh(2:2:Emmmm,2:2:Enmmm,2)+rh(4:2:Emm,2:2:Enmmm,Epm)+...
%     rh(4:2:Emm,2:2:Enmmm,2)+rh(2:2:Emmmm,4:2:Enm,Epm)+rh(2:2:Emmmm,4:2:Enm,2)+...
%     rh(4:2:Emm,4:2:Enm,Epm)+rh(4:2:Emm,4:2:Enm,2))/64+...
%     (rh(2:2:Emmmm,2:2:Enmmm,1)+rh(2:2:Emmmm,4:2:Enm,1)+...
%     rh(4:2:Emm,2:2:Enmmm,1)+rh(4:2:Emm,4:2:Enm,1)+...
%     rh(4:2:Emm,3:2:Enmm,Epm)+rh(4:2:Emm,3:2:Enmm,2)+rh(3:2:Emmm,4:2:Enm,Epm)+...
%     rh(3:2:Emmm,4:2:Enm,2)+rh(2:2:Emmmm,3:2:Enmm,2)+...
%     rh(2:2:Emmmm,3:2:Enmm,Epm)+rh(3:2:Emmm,2:2:Enmmm,Epm)+rh(3:2:Emmm,2:2:Enmmm,2))/32+...
%     (rh(4:2:Emm,3:2:Enmm,1)+rh(2:2:Emmmm,3:2:Enmm,1)+...
%     rh(3:2:Emmm,2:2:Enmmm,1)+rh(3:2:Emmm,4:2:Enm,1)+...
%     rh(3:2:Emmm,3:2:Enmm,Epm)+rh(3:2:Emmm,3:2:Enmm,2))/16+rh(3:2:Emmm,3:2:Enmm,1)/8;
