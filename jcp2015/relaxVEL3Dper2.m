function [vhx,vhy,vhz]=relaxVEL3Dper2(vhx,vhy,vhz,fhx,fhy,fhz,vcoef,numrel) 
%#codegen
[Em,En,Ep]=size(vhx);
Emm=Em-1;
Enm=En-1;
Emmm=Em-2;
Enmm=En-2;
Emmmm=Em-3;
Enmmm=En-3;
Epm=Ep-1;
Epmm=Ep-2;
Epmmm=Ep-3;

% w=1.36;
% w=.975;
% w=1;

% coef=ones(size(vh));

% rhsdivcoefx=fhx(2:Emm,2:Enm,2:Epm)./vcoef.coef;
% rhsdivcoefy=fhy(2:Emm,2:Enm,2:Epm)./vcoef.coef;
% rhsdivcoefz=fhz(2:Emm,2:Enm,2:Epm)./vcoef.coef;
% vhnew=vh;

%     rhsdivcoefred=fh(Indrb.red)./vcoef.coef(Indrb.redint);
%     rhsdivcoefblack=fh(Indrb.black)./vcoef.coef(Indrb.blackint);
%     rhsdivcoefboundx=fhx(2:Emm,2:Enm,Ep)./vcoef.coefbound;
%     rhsdivcoefboundy=fhy(2:Emm,2:Enm,Ep)./vcoef.coefbound;
%     rhsdivcoefboundz=fhz(2:Emm,2:Enm,Ep)./vcoef.coefbound;

    for c1=1:numrel
        %%%%%%%%%%%%  x vel
        
        
        %red even pgs  ux
        vhx(2:2:Emm,2:2:Enm,2:2:Epm)=(fhx(2:2:Emm,2:2:Enm,2:2:Epm)+...
            2*vcoef.rescoefpp1(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhx(2:2:Emm,3:2:En,2:2:Epm)+2*vcoef.rescoefpm1(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhx(2:2:Emm,1:2:Enmm,2:2:Epm)+...
            vcoef.rescoefpp2(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhx(3:2:Em,2:2:Enm,2:2:Epm)+vcoef.rescoefpm2(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhx(1:2:Emmm,2:2:Enm,2:2:Epm)+...
            vcoef.rescoefpp3(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhx(2:2:Emm,2:2:Enm,3:2:Ep)+vcoef.rescoefpm3(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhx(2:2:Emm,2:2:Enm,1:2:Epmm)+...
            vcoef.viscpp2(1:2:Emmm,1:2:Enmm,1:2:Epmm).*(vhy(3:2:Em,3:2:En,2:2:Epm)-vhy(3:2:Em,1:2:Enmm,2:2:Epm))+...
            vcoef.viscpm2(1:2:Emmm,1:2:Enmm,1:2:Epmm).*(vhy(1:2:Emmm,1:2:Enmm,2:2:Epm)-vhy(1:2:Emmm,3:2:En,2:2:Epm))...
            +vcoef.viscpp3(1:2:Emmm,1:2:Enmm,1:2:Epmm).*(vhz(2:2:Emm,3:2:En,3:2:Ep)-vhz(2:2:Emm,1:2:Enmm,3:2:Ep))+...
            vcoef.viscpm3(1:2:Emmm,1:2:Enmm,1:2:Epmm).*(vhz(2:2:Emm,1:2:Enmm,1:2:Epmm)-vhz(2:2:Emm,3:2:En,1:2:Epmm)))./vcoef.coefx(1:2:Emmm,1:2:Enmm,1:2:Epmm);
        
%         
        vhx(3:2:Emmm,3:2:Enmm,2:2:Epm)=(fhx(3:2:Emmm,3:2:Enmm,2:2:Epm)+...
            2*vcoef.rescoefpp1(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhx(3:2:Emmm,4:2:Enm,2:2:Epm)+2*vcoef.rescoefpm1(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhx(3:2:Emmm,2:2:Enmmm,2:2:Epm)+...
            vcoef.rescoefpp2(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhx(4:2:Emm,3:2:Enmm,2:2:Epm)+vcoef.rescoefpm2(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhx(2:2:Emmmm,3:2:Enmm,2:2:Epm)+...
            vcoef.rescoefpp3(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhx(3:2:Emmm,3:2:Enmm,3:2:Ep)+vcoef.rescoefpm3(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhx(3:2:Emmm,3:2:Enmm,1:2:Epmm)+...
            vcoef.viscpp2(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*(vhy(4:2:Emm,4:2:Enm,2:2:Epm)-vhy(4:2:Emm,2:2:Enmmm,2:2:Epm))+...
            vcoef.viscpm2(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*(vhy(2:2:Emmmm,2:2:Enmmm,2:2:Epm)-vhy(2:2:Emmmm,4:2:Enm,2:2:Epm))...
            +vcoef.viscpp3(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*(vhz(3:2:Emmm,4:2:Enm,3:2:Ep)-vhz(3:2:Emmm,2:2:Enmmm,3:2:Ep))+...
            vcoef.viscpm3(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*(vhz(3:2:Emmm,2:2:Enmmm,1:2:Epmm)-vhz(3:2:Emmm,4:2:Enm,1:2:Epmm)))./vcoef.coefx(2:2:Emmmm,2:2:Enmmm,1:2:Epmm);
        
        vhx(3:2:Emmm,En,2:2:Epm)=(fhx(3:2:Emmm,En,2:2:Epm)+...
            2*vcoef.rescoefpp1boundR(2:2:Emmmm,1,1:2:Epmm).*vhx(3:2:Emmm,2,2:2:Epm)+2*vcoef.rescoefpm1boundR(2:2:Emmmm,1,1:2:Epmm).*vhx(3:2:Emmm,Enm,2:2:Epm)+...
            vcoef.rescoefpp2boundR(2:2:Emmmm,1,1:2:Epmm).*vhx(4:2:Emm,En,2:2:Epm)+vcoef.rescoefpm2boundR(2:2:Emmmm,1,1:2:Epmm).*vhx(2:2:Emmmm,En,2:2:Epm)+...
            vcoef.rescoefpp3boundR(2:2:Emmmm,1,1:2:Epmm).*vhx(3:2:Emmm,En,3:2:Ep)+vcoef.rescoefpm3boundR(2:2:Emmmm,1,1:2:Epmm).*vhx(3:2:Emmm,En,1:2:Epmm)+...
            vcoef.viscpp2(2:2:Emmmm,Enm,1:2:Epmm).*(vhy(4:2:Emm,2,2:2:Epm)-vhy(4:2:Emm,Enm,2:2:Epm))+...
            vcoef.viscpm2(2:2:Emmmm,Enm,1:2:Epmm).*(vhy(2:2:Emmmm,Enm,2:2:Epm)-vhy(2:2:Emmmm,2,2:2:Epm))...
            +vcoef.viscpp3(2:2:Emmmm,Enm,1:2:Epmm).*(vhz(3:2:Emmm,2,3:2:Ep)-vhz(3:2:Emmm,Enm,3:2:Ep))+...
            vcoef.viscpm3(2:2:Emmmm,Enm,1:2:Epmm).*(vhz(3:2:Emmm,Enm,1:2:Epmm)-vhz(3:2:Emmm,2,1:2:Epmm)))./vcoef.coefxboundR(2:2:Emmmm,1,1:2:Epmm);
        vhx(3:2:Emmm,1,2:2:Epm)=vhx(3:2:Emmm,En,2:2:Epm);
      
%         %red odd pgs  ux
        vhx(2:2:Emm,3:2:Enmm,3:2:Epmm)=(fhx(2:2:Emm,3:2:Enmm,3:2:Epmm)+...
            2*vcoef.rescoefpp1(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhx(2:2:Emm,4:2:Enm,3:2:Epmm)+2*vcoef.rescoefpm1(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhx(2:2:Emm,2:2:Enmmm,3:2:Epmm)+...
            vcoef.rescoefpp2(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhx(3:2:Em,3:2:Enmm,3:2:Epmm)+vcoef.rescoefpm2(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhx(1:2:Emmm,3:2:Enmm,3:2:Epmm)+...
            vcoef.rescoefpp3(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhx(2:2:Emm,3:2:Enmm,4:2:Epm)+vcoef.rescoefpm3(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhx(2:2:Emm,3:2:Enmm,2:2:Epmmm)+...
            vcoef.viscpp2(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*(vhy(3:2:Em,4:2:Enm,3:2:Epmm)-vhy(3:2:Em,2:2:Enmmm,3:2:Epmm))+...
            vcoef.viscpm2(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*(vhy(1:2:Emmm,2:2:Enmmm,3:2:Epmm)-vhy(1:2:Emmm,4:2:Enm,3:2:Epmm))...
            +vcoef.viscpp3(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*(vhz(2:2:Emm,4:2:Enm,4:2:Epm)-vhz(2:2:Emm,2:2:Enmmm,4:2:Epm))+...
            vcoef.viscpm3(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*(vhz(2:2:Emm,2:2:Enmmm,2:2:Epmmm)-vhz(2:2:Emm,4:2:Enm,2:2:Epmmm)))./vcoef.coefx(1:2:Emmm,2:2:Enmmm,2:2:Epmmm);
        
        vhx(2:2:Emm,En,3:2:Epmm)=(fhx(2:2:Emm,En,3:2:Epmm)+...
            2*vcoef.rescoefpp1boundR(1:2:Emmm,1,2:2:Epmmm).*vhx(2:2:Emm,2,3:2:Epmm)+2*vcoef.rescoefpm1boundR(1:2:Emmm,1,2:2:Epmmm).*vhx(2:2:Emm,Enm,3:2:Epmm)+...
            vcoef.rescoefpp2boundR(1:2:Emmm,1,2:2:Epmmm).*vhx(3:2:Em,En,3:2:Epmm)+vcoef.rescoefpm2boundR(1:2:Emmm,1,2:2:Epmmm).*vhx(1:2:Emmm,En,3:2:Epmm)+...
            vcoef.rescoefpp3boundR(1:2:Emmm,1,2:2:Epmmm).*vhx(2:2:Emm,En,4:2:Epm)+vcoef.rescoefpm3boundR(1:2:Emmm,1,2:2:Epmmm).*vhx(2:2:Emm,En,2:2:Epmmm)+...
            vcoef.viscpp2(1:2:Emmm,Enm,2:2:Epmmm).*(vhy(3:2:Em,2,3:2:Epmm)-vhy(3:2:Em,Enm,3:2:Epmm))+...
            vcoef.viscpm2(1:2:Emmm,Enm,2:2:Epmmm).*(vhy(1:2:Emmm,Enm,3:2:Epmm)-vhy(1:2:Emmm,2,3:2:Epmm))...
            +vcoef.viscpp3(1:2:Emmm,Enm,2:2:Epmmm).*(vhz(2:2:Emm,2,4:2:Epm)-vhz(2:2:Emm,Enm,4:2:Epm))+...
            vcoef.viscpm3(1:2:Emmm,Enm,2:2:Epmmm).*(vhz(2:2:Emm,Enm,2:2:Epmmm)-vhz(2:2:Emm,2,2:2:Epmmm)))./vcoef.coefxboundR(1:2:Emmm,1,2:2:Epmmm);
        vhx(2:2:Emm,1,3:2:Epmm)=vhx(2:2:Emm,En,3:2:Epmm);
        
        vhx(2:2:Emm,3:2:Enmm,Ep)=(fhx(2:2:Emm,3:2:Enmm,Ep)+...
            2*vcoef.rescoefpp1boundF(1:2:Emmm,2:2:Enmmm).*vhx(2:2:Emm,4:2:Enm,Ep)+2*vcoef.rescoefpm1boundF(1:2:Emmm,2:2:Enmmm).*vhx(2:2:Emm,2:2:Enmmm,Ep)+...
            vcoef.rescoefpp2boundF(1:2:Emmm,2:2:Enmmm).*vhx(3:2:Em,3:2:Enmm,Ep)+vcoef.rescoefpm2boundF(1:2:Emmm,2:2:Enmmm).*vhx(1:2:Emmm,3:2:Enmm,Ep)+...
            vcoef.rescoefpp3boundF(1:2:Emmm,2:2:Enmmm).*vhx(2:2:Emm,3:2:Enmm,2)+vcoef.rescoefpm3boundF(1:2:Emmm,2:2:Enmmm).*vhx(2:2:Emm,3:2:Enmm,Epm)+...
            vcoef.viscpp2(1:2:Emmm,2:2:Enmmm,Epm).*(vhy(3:2:Em,4:2:Enm,Ep)-vhy(3:2:Em,2:2:Enmmm,Ep))+vcoef.viscpm2(1:2:Emmm,2:2:Enmmm,Epm).*(vhy(1:2:Emmm,2:2:Enmmm,Ep)-vhy(1:2:Emmm,4:2:Enm,Ep))...
            +vcoef.viscpp3(1:2:Emmm,2:2:Enmmm,Epm).*(vhz(2:2:Emm,4:2:Enm,2)-vhz(2:2:Emm,2:2:Enmmm,2))+vcoef.viscpm3(1:2:Emmm,2:2:Enmmm,Epm).*(vhz(2:2:Emm,2:2:Enmmm,Epm)-vhz(2:2:Emm,4:2:Enm,Epm)))./vcoef.coefxboundF(1:2:Emmm,2:2:Enmmm);
            vhx(2:2:Emm,3:2:Enmm,1)=vhx(2:2:Emm,3:2:Enmm,Ep);
            
        vhx(2:2:Emm,En,Ep)=(fhx(2:2:Emm,En,Ep)+...
            2*vcoef.rescoefpp1boundFR(1:2:Emmm).*vhx(2:2:Emm,2,Ep)+2*vcoef.rescoefpm1boundFR(1:2:Emmm).*vhx(2:2:Emm,Enm,Ep)+...
            vcoef.rescoefpp2boundFR(1:2:Emmm).*vhx(3:2:Em,En,Ep)+vcoef.rescoefpm2boundFR(1:2:Emmm).*vhx(1:2:Emmm,En,Ep)+...
            vcoef.rescoefpp3boundFR(1:2:Emmm).*vhx(2:2:Emm,En,2)+vcoef.rescoefpm3boundFR(1:2:Emmm).*vhx(2:2:Emm,En,Epm)+...
            vcoef.viscpp2(1:2:Emmm,Enm,Epm).*(vhy(3:2:Em,2,Ep)-vhy(3:2:Em,Enm,Ep))+vcoef.viscpm2(1:2:Emmm,Enm,Epm).*(vhy(1:2:Emmm,Enm,Ep)-vhy(1:2:Emmm,2,Ep))...
            +vcoef.viscpp3(1:2:Emmm,Enm,Epm).*(vhz(2:2:Emm,2,2)-vhz(2:2:Emm,Enm,2))+vcoef.viscpm3(1:2:Emmm,Enm,Epm).*(vhz(2:2:Emm,Enm,Epm)-vhz(2:2:Emm,2,Epm)))./vcoef.coefxboundFR(1:2:Emmm);
            vhx(2:2:Emm,1,1)=vhx(2:2:Emm,En,Ep);
            vhx(2:2:Emm,En,1)=vhx(2:2:Emm,En,Ep);
            vhx(2:2:Emm,1,Ep)=vhx(2:2:Emm,En,Ep);
        
        
        vhx(3:2:Emmm,2:2:Enm,3:2:Epmm)=(fhx(3:2:Emmm,2:2:Enm,3:2:Epmm)+...
            2*vcoef.rescoefpp1(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhx(3:2:Emmm,3:2:En,3:2:Epmm)+2*vcoef.rescoefpm1(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhx(3:2:Emmm,1:2:Enmm,3:2:Epmm)+...
            vcoef.rescoefpp2(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhx(4:2:Emm,2:2:Enm,3:2:Epmm)+vcoef.rescoefpm2(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhx(2:2:Emmmm,2:2:Enm,3:2:Epmm)+...
            vcoef.rescoefpp3(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhx(3:2:Emmm,2:2:Enm,4:2:Epm)+vcoef.rescoefpm3(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhx(3:2:Emmm,2:2:Enm,2:2:Epmmm)+...
            vcoef.viscpp2(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*(vhy(4:2:Emm,3:2:En,3:2:Epmm)-vhy(4:2:Emm,1:2:Enmm,3:2:Epmm))+...
            vcoef.viscpm2(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*(vhy(2:2:Emmmm,1:2:Enmm,3:2:Epmm)-vhy(2:2:Emmmm,3:2:En,3:2:Epmm))...
            +vcoef.viscpp3(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*(vhz(3:2:Emmm,3:2:En,4:2:Epm)-vhz(3:2:Emmm,1:2:Enmm,4:2:Epm))+...
            vcoef.viscpm3(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*(vhz(3:2:Emmm,1:2:Enmm,2:2:Epmmm)-vhz(3:2:Emmm,3:2:En,2:2:Epmmm)))./vcoef.coefx(2:2:Emmmm,1:2:Enmm,2:2:Epmmm);
        
        vhx(3:2:Emmm,2:2:Enm,Ep)=(fhx(3:2:Emmm,2:2:Enm,Ep)+...
            2*vcoef.rescoefpp1boundF(2:2:Emmmm,1:2:Enmm).*vhx(3:2:Emmm,3:2:En,Ep)+2*vcoef.rescoefpm1boundF(2:2:Emmmm,1:2:Enmm).*vhx(3:2:Emmm,1:2:Enmm,Ep)+...
            vcoef.rescoefpp2boundF(2:2:Emmmm,1:2:Enmm).*vhx(4:2:Emm,2:2:Enm,Ep)+vcoef.rescoefpm2boundF(2:2:Emmmm,1:2:Enmm).*vhx(2:2:Emmmm,2:2:Enm,Ep)+...
            vcoef.rescoefpp3boundF(2:2:Emmmm,1:2:Enmm).*vhx(3:2:Emmm,2:2:Enm,2)+vcoef.rescoefpm3boundF(2:2:Emmmm,1:2:Enmm).*vhx(3:2:Emmm,2:2:Enm,Epm)+...
            vcoef.viscpp2(2:2:Emmmm,1:2:Enmm,Epm).*(vhy(4:2:Emm,3:2:En,Ep)-vhy(4:2:Emm,1:2:Enmm,Ep))+vcoef.viscpm2(2:2:Emmmm,1:2:Enmm,Epm).*(vhy(2:2:Emmmm,1:2:Enmm,Ep)-vhy(2:2:Emmmm,3:2:En,Ep))...
            +vcoef.viscpp3(2:2:Emmmm,1:2:Enmm,Epm).*(vhz(3:2:Emmm,3:2:En,2)-vhz(3:2:Emmm,1:2:Enmm,2))+vcoef.viscpm3(2:2:Emmmm,1:2:Enmm,Epm).*(vhz(3:2:Emmm,1:2:Enmm,Epm)-vhz(3:2:Emmm,3:2:En,Epm)))./vcoef.coefxboundF(2:2:Emmmm,1:2:Enmm);
        vhx(3:2:Emmm,2:2:Enm,1)=vhx(3:2:Emmm,2:2:Enm,Ep);




        
                %red even pgs  uy
%         
        vhy(2:2:Emm,2:2:Enm,2:2:Epm)=(fhy(2:2:Emm,2:2:Enm,2:2:Epm)+...
            vcoef.rescoefpp1(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhy(2:2:Emm,3:2:En,2:2:Epm)+vcoef.rescoefpm1(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhy(2:2:Emm,1:2:Enmm,2:2:Epm)+...
            2*vcoef.rescoefpp2(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhy(3:2:Em,2:2:Enm,2:2:Epm)+2*vcoef.rescoefpm2(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhy(1:2:Emmm,2:2:Enm,2:2:Epm)+...
            vcoef.rescoefpp3(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhy(2:2:Emm,2:2:Enm,3:2:Ep)+vcoef.rescoefpm3(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhy(2:2:Emm,2:2:Enm,1:2:Epmm)+...
            vcoef.viscpp1(1:2:Emmm,1:2:Enmm,1:2:Epmm).*(vhx(3:2:Em,3:2:En,2:2:Epm)-vhx(1:2:Emmm,3:2:En,2:2:Epm))+...
            vcoef.viscpm1(1:2:Emmm,1:2:Enmm,1:2:Epmm).*(vhx(1:2:Emmm,1:2:Enmm,2:2:Epm)-vhx(3:2:Em,1:2:Enmm,2:2:Epm))...
            +vcoef.viscpp3(1:2:Emmm,1:2:Enmm,1:2:Epmm).*(vhz(3:2:Em,2:2:Enm,3:2:Ep)-vhz(1:2:Emmm,2:2:Enm,3:2:Ep))+...
            vcoef.viscpm3(1:2:Emmm,1:2:Enmm,1:2:Epmm).*(vhz(1:2:Emmm,2:2:Enm,1:2:Epmm)-vhz(3:2:Em,2:2:Enm,1:2:Epmm)))./vcoef.coefy(1:2:Emmm,1:2:Enmm,1:2:Epmm);
       
        vhy(3:2:Emmm,3:2:Enmm,2:2:Epm)=(fhy(3:2:Emmm,3:2:Enmm,2:2:Epm)+...
            vcoef.rescoefpp1(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhy(3:2:Emmm,4:2:Enm,2:2:Epm)+vcoef.rescoefpm1(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhy(3:2:Emmm,2:2:Enmmm,2:2:Epm)+...
            2*vcoef.rescoefpp2(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhy(4:2:Emm,3:2:Enmm,2:2:Epm)+2*vcoef.rescoefpm2(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhy(2:2:Emmmm,3:2:Enmm,2:2:Epm)+...
            vcoef.rescoefpp3(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhy(3:2:Emmm,3:2:Enmm,3:2:Ep)+vcoef.rescoefpm3(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhy(3:2:Emmm,3:2:Enmm,1:2:Epmm)+...
            vcoef.viscpp1(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*(vhx(4:2:Emm,4:2:Enm,2:2:Epm)-vhx(2:2:Emmmm,4:2:Enm,2:2:Epm))+...
            vcoef.viscpm1(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*(vhx(2:2:Emmmm,2:2:Enmmm,2:2:Epm)-vhx(4:2:Emm,2:2:Enmmm,2:2:Epm))...
            +vcoef.viscpp3(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*(vhz(4:2:Emm,3:2:Enmm,3:2:Ep)-vhz(2:2:Emmmm,3:2:Enmm,3:2:Ep))+...
            vcoef.viscpm3(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*(vhz(2:2:Emmmm,3:2:Enmm,1:2:Epmm)-vhz(4:2:Emm,3:2:Enmm,1:2:Epmm)))./vcoef.coefy(2:2:Emmmm,2:2:Enmmm,1:2:Epmm);
         
        vhy(3:2:Emmm,En,2:2:Epm)=(fhy(3:2:Emmm,En,2:2:Epm)+...
           vcoef.rescoefpp1boundR(2:2:Emmmm,1,1:2:Epmm).*vhy(3:2:Emmm,2,2:2:Epm)+vcoef.rescoefpm1boundR(2:2:Emmmm,1,1:2:Epmm).*vhy(3:2:Emmm,Enm,2:2:Epm)+...
           2*vcoef.rescoefpp2boundR(2:2:Emmmm,1,1:2:Epmm).*vhy(4:2:Emm,En,2:2:Epm)+2*vcoef.rescoefpm2boundR(2:2:Emmmm,1,1:2:Epmm).*vhy(2:2:Emmmm,En,2:2:Epm)+...
           vcoef.rescoefpp3boundR(2:2:Emmmm,1,1:2:Epmm).*vhy(3:2:Emmm,En,3:2:Ep)+vcoef.rescoefpm3boundR(2:2:Emmmm,1,1:2:Epmm).*vhy(3:2:Emmm,En,1:2:Epmm)+...
           vcoef.viscpp1(2:2:Emmmm,Enm,1:2:Epmm).*(vhx(4:2:Emm,2,2:2:Epm)-vhx(2:2:Emmmm,2,2:2:Epm))+...
           vcoef.viscpm1(2:2:Emmmm,Enm,1:2:Epmm).*(vhx(2:2:Emmmm,Enm,2:2:Epm)-vhx(4:2:Emm,Enm,2:2:Epm))...
           +vcoef.viscpp3(2:2:Emmmm,Enm,1:2:Epmm).*(vhz(4:2:Emm,En,3:2:Ep)-vhz(2:2:Emmmm,En,3:2:Ep))+...
           vcoef.viscpm3(2:2:Emmmm,Enm,1:2:Epmm).*(vhz(2:2:Emmmm,En,1:2:Epmm)-vhz(4:2:Emm,En,1:2:Epmm)))./vcoef.coefyboundR(2:2:Emmmm,1,1:2:Epmm);
       vhy(3:2:Emmm,1,2:2:Epm)=vhy(3:2:Emmm,En,2:2:Epm);
%                  
%        %red odd pgs  uy
        vhy(2:2:Emm,3:2:Enmm,3:2:Epmm)=(fhy(2:2:Emm,3:2:Enmm,3:2:Epmm)+...
            vcoef.rescoefpp1(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhy(2:2:Emm,4:2:Enm,3:2:Epmm)+vcoef.rescoefpm1(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhy(2:2:Emm,2:2:Enmmm,3:2:Epmm)+...
            2*vcoef.rescoefpp2(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhy(3:2:Em,3:2:Enmm,3:2:Epmm)+2*vcoef.rescoefpm2(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhy(1:2:Emmm,3:2:Enmm,3:2:Epmm)+...
            vcoef.rescoefpp3(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhy(2:2:Emm,3:2:Enmm,4:2:Epm)+vcoef.rescoefpm3(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhy(2:2:Emm,3:2:Enmm,2:2:Epmmm)+...
            vcoef.viscpp1(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*(vhx(3:2:Em,4:2:Enm,3:2:Epmm)-vhx(1:2:Emmm,4:2:Enm,3:2:Epmm))+...
            vcoef.viscpm1(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*(vhx(1:2:Emmm,2:2:Enmmm,3:2:Epmm)-vhx(3:2:Em,2:2:Enmmm,3:2:Epmm))...
            +vcoef.viscpp3(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*(vhz(3:2:Em,3:2:Enmm,4:2:Epm)-vhz(1:2:Emmm,3:2:Enmm,4:2:Epm))+...
            vcoef.viscpm3(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*(vhz(1:2:Emmm,3:2:Enmm,2:2:Epmmm)-vhz(3:2:Em,3:2:Enmm,2:2:Epmmm)))./vcoef.coefy(1:2:Emmm,2:2:Enmmm,2:2:Epmmm);
        
        vhy(2:2:Emm,En,3:2:Epmm)=(fhy(2:2:Emm,En,3:2:Epmm)+...
            vcoef.rescoefpp1boundR(1:2:Emmm,1,2:2:Epmmm).*vhy(2:2:Emm,2,3:2:Epmm)+vcoef.rescoefpm1boundR(1:2:Emmm,1,2:2:Epmmm).*vhy(2:2:Emm,Enm,3:2:Epmm)+...
            2*vcoef.rescoefpp2boundR(1:2:Emmm,1,2:2:Epmmm).*vhy(3:2:Em,En,3:2:Epmm)+2*vcoef.rescoefpm2boundR(1:2:Emmm,1,2:2:Epmmm).*vhy(1:2:Emmm,En,3:2:Epmm)+...
            vcoef.rescoefpp3boundR(1:2:Emmm,1,2:2:Epmmm).*vhy(2:2:Emm,En,4:2:Epm)+vcoef.rescoefpm3boundR(1:2:Emmm,1,2:2:Epmmm).*vhy(2:2:Emm,En,2:2:Epmmm)+...
            vcoef.viscpp1(1:2:Emmm,Enm,2:2:Epmmm).*(vhx(3:2:Em,2,3:2:Epmm)-vhx(1:2:Emmm,2,3:2:Epmm))+...
            vcoef.viscpm1(1:2:Emmm,Enm,2:2:Epmmm).*(vhx(1:2:Emmm,Enm,3:2:Epmm)-vhx(3:2:Em,Enm,3:2:Epmm))...
            +vcoef.viscpp3(1:2:Emmm,Enm,2:2:Epmmm).*(vhz(3:2:Em,En,4:2:Epm)-vhz(1:2:Emmm,En,4:2:Epm))+...
            vcoef.viscpm3(1:2:Emmm,Enm,2:2:Epmmm).*(vhz(1:2:Emmm,En,2:2:Epmmm)-vhz(3:2:Em,En,2:2:Epmmm)))./vcoef.coefyboundR(1:2:Emmm,1,2:2:Epmmm);
        vhy(2:2:Emm,1,3:2:Epmm)=vhy(2:2:Emm,En,3:2:Epmm);
        
        
         vhy(2:2:Emm,3:2:Enmm,Ep)=(fhy(2:2:Emm,3:2:Enmm,Ep)+...
           vcoef.rescoefpp1boundF(1:2:Emmm,2:2:Enmmm).*vhy(2:2:Emm,4:2:Enm,Ep)+vcoef.rescoefpm1boundF(1:2:Emmm,2:2:Enmmm).*vhy(2:2:Emm,2:2:Enmmm,Ep)+...
           2*vcoef.rescoefpp2boundF(1:2:Emmm,2:2:Enmmm).*vhy(3:2:Em,3:2:Enmm,Ep)+2*vcoef.rescoefpm2boundF(1:2:Emmm,2:2:Enmmm).*vhy(1:2:Emmm,3:2:Enmm,Ep)+...
           vcoef.rescoefpp3boundF(1:2:Emmm,2:2:Enmmm).*vhy(2:2:Emm,3:2:Enmm,2)+vcoef.rescoefpm3boundF(1:2:Emmm,2:2:Enmmm).*vhy(2:2:Emm,3:2:Enmm,Epm)+...
           vcoef.viscpp1(1:2:Emmm,2:2:Enmmm,Epm).*(vhx(3:2:Em,4:2:Enm,Ep)-vhx(1:2:Emmm,4:2:Enm,Ep))+vcoef.viscpm1(1:2:Emmm,2:2:Enmmm,Epm).*(vhx(1:2:Emmm,2:2:Enmmm,Ep)-vhx(3:2:Em,2:2:Enmmm,Ep))...
           +vcoef.viscpp3(1:2:Emmm,2:2:Enmmm,Epm).*(vhz(3:2:Em,3:2:Enmm,2)-vhz(1:2:Emmm,3:2:Enmm,2))+vcoef.viscpm3(1:2:Emmm,2:2:Enmmm,Epm).*(vhz(1:2:Emmm,3:2:Enmm,Epm)-vhz(3:2:Em,3:2:Enmm,Epm)))./vcoef.coefyboundF(1:2:Emmm,2:2:Enmmm);
        vhy(2:2:Emm,3:2:Enmm,1)=vhy(2:2:Emm,3:2:Enmm,Ep);  
            
        vhy(2:2:Emm,En,Ep)=(fhy(2:2:Emm,En,Ep)+...
           vcoef.rescoefpp1boundFR(1:2:Emmm).*vhy(2:2:Emm,2,Ep)+vcoef.rescoefpm1boundFR(1:2:Emmm).*vhy(2:2:Emm,Enm,Ep)+...
           2*vcoef.rescoefpp2boundFR(1:2:Emmm).*vhy(3:2:Em,En,Ep)+2*vcoef.rescoefpm2boundFR(1:2:Emmm).*vhy(1:2:Emmm,En,Ep)+...
           vcoef.rescoefpp3boundFR(1:2:Emmm).*vhy(2:2:Emm,En,2)+vcoef.rescoefpm3boundFR(1:2:Emmm).*vhy(2:2:Emm,En,Epm)+...
           vcoef.viscpp1(1:2:Emmm,Enm,Epm).*(vhx(3:2:Em,2,Ep)-vhx(1:2:Emmm,2,Ep))+vcoef.viscpm1(1:2:Emmm,Enm,Epm).*(vhx(1:2:Emmm,Enm,Ep)-vhx(3:2:Em,Enm,Ep))...
           +vcoef.viscpp3(1:2:Emmm,Enm,Epm).*(vhz(3:2:Em,En,2)-vhz(1:2:Emmm,En,2))+vcoef.viscpm3(1:2:Emmm,Enm,Epm).*(vhz(1:2:Emmm,En,Epm)-vhz(3:2:Em,En,Epm)))./vcoef.coefyboundFR(1:2:Emmm);
        vhy(2:2:Emm,1,1)=vhy(2:2:Emm,En,Ep);  
        vhy(2:2:Emm,1,Ep)=vhy(2:2:Emm,En,Ep);  
        vhy(2:2:Emm,En,1)=vhy(2:2:Emm,En,Ep);  
          
        vhy(3:2:Emmm,2:2:Enm,3:2:Epmm)=(fhy(3:2:Emmm,2:2:Enm,3:2:Epmm)+...
            vcoef.rescoefpp1(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhy(3:2:Emmm,3:2:En,3:2:Epmm)+vcoef.rescoefpm1(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhy(3:2:Emmm,1:2:Enmm,3:2:Epmm)+...
            2*vcoef.rescoefpp2(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhy(4:2:Emm,2:2:Enm,3:2:Epmm)+2*vcoef.rescoefpm2(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhy(2:2:Emmmm,2:2:Enm,3:2:Epmm)+...
            vcoef.rescoefpp3(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhy(3:2:Emmm,2:2:Enm,4:2:Epm)+vcoef.rescoefpm3(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhy(3:2:Emmm,2:2:Enm,2:2:Epmmm)+...
            vcoef.viscpp1(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*(vhx(4:2:Emm,3:2:En,3:2:Epmm)-vhx(2:2:Emmmm,3:2:En,3:2:Epmm))+...
            vcoef.viscpm1(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*(vhx(2:2:Emmmm,1:2:Enmm,3:2:Epmm)-vhx(4:2:Emm,1:2:Enmm,3:2:Epmm))...
            +vcoef.viscpp3(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*(vhz(4:2:Emm,2:2:Enm,4:2:Epm)-vhz(2:2:Emmmm,2:2:Enm,4:2:Epm))+...
            vcoef.viscpm3(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*(vhz(2:2:Emmmm,2:2:Enm,2:2:Epmmm)-vhz(4:2:Emm,2:2:Enm,2:2:Epmmm)))./vcoef.coefy(2:2:Emmmm,1:2:Enmm,2:2:Epmmm);
        
         vhy(3:2:Emmm,2:2:Enm,Ep)=(fhy(3:2:Emmm,2:2:Enm,Ep)+...
            vcoef.rescoefpp1boundF(2:2:Emmmm,1:2:Enmm).*vhy(3:2:Emmm,3:2:En,Ep)+vcoef.rescoefpm1boundF(2:2:Emmmm,1:2:Enmm).*vhy(3:2:Emmm,1:2:Enmm,Ep)+...
            2*vcoef.rescoefpp2boundF(2:2:Emmmm,1:2:Enmm).*vhy(4:2:Emm,2:2:Enm,Ep)+2*vcoef.rescoefpm2boundF(2:2:Emmmm,1:2:Enmm).*vhy(2:2:Emmmm,2:2:Enm,Ep)+...
            vcoef.rescoefpp3boundF(2:2:Emmmm,1:2:Enmm).*vhy(3:2:Emmm,2:2:Enm,2)+vcoef.rescoefpm3boundF(2:2:Emmmm,1:2:Enmm).*vhy(3:2:Emmm,2:2:Enm,Epm)+...
            vcoef.viscpp1(2:2:Emmmm,1:2:Enmm,Epm).*(vhx(4:2:Emm,3:2:En,Ep)-vhx(2:2:Emmmm,3:2:En,Ep))+vcoef.viscpm1(2:2:Emmmm,1:2:Enmm,Epm).*(vhx(2:2:Emmmm,1:2:Enmm,Ep)-vhx(4:2:Emm,1:2:Enmm,Ep))...
            +vcoef.viscpp3(2:2:Emmmm,1:2:Enmm,Epm).*(vhz(4:2:Emm,2:2:Enm,2)-vhz(2:2:Emmmm,2:2:Enm,2))+vcoef.viscpm3(2:2:Emmmm,1:2:Enmm,Epm).*(vhz(2:2:Emmmm,2:2:Enm,Epm)-vhz(4:2:Emm,2:2:Enm,Epm)))./vcoef.coefyboundF(2:2:Emmmm,1:2:Enmm);
         vhy(3:2:Emmm,2:2:Enm,1)=vhy(3:2:Emmm,2:2:Enm,Ep); 
%         





%         %red even pages uz
         vhz(2:2:Emm,2:2:Enm,2:2:Epm)=(fhz(2:2:Emm,2:2:Enm,2:2:Epm)+...
            vcoef.rescoefpp1(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhz(2:2:Emm,3:2:En,2:2:Epm)+vcoef.rescoefpm1(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhz(2:2:Emm,1:2:Enmm,2:2:Epm)+...
            vcoef.rescoefpp2(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhz(3:2:Em,2:2:Enm,2:2:Epm)+vcoef.rescoefpm2(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhz(1:2:Emmm,2:2:Enm,2:2:Epm)+...
            2*vcoef.rescoefpp3(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhz(2:2:Emm,2:2:Enm,3:2:Ep)+2*vcoef.rescoefpm3(1:2:Emmm,1:2:Enmm,1:2:Epmm).*vhz(2:2:Emm,2:2:Enm,1:2:Epmm)+...
            vcoef.viscpp1(1:2:Emmm,1:2:Enmm,1:2:Epmm).*(vhx(2:2:Emm,3:2:En,3:2:Ep)-vhx(2:2:Emm,3:2:En,1:2:Epmm))+...
            vcoef.viscpm1(1:2:Emmm,1:2:Enmm,1:2:Epmm).*(vhx(2:2:Emm,1:2:Enmm,1:2:Epmm)-vhx(2:2:Emm,1:2:Enmm,3:2:Ep))...
            +vcoef.viscpp2(1:2:Emmm,1:2:Enmm,1:2:Epmm).*(vhy(3:2:Em,2:2:Enm,3:2:Ep)-vhy(3:2:Em,2:2:Enm,1:2:Epmm))+...
            vcoef.viscpm2(1:2:Emmm,1:2:Enmm,1:2:Epmm).*(vhy(1:2:Emmm,2:2:Enm,1:2:Epmm)-vhy(1:2:Emmm,2:2:Enm,3:2:Ep))...
            )./vcoef.coefz(1:2:Emmm,1:2:Enmm,1:2:Epmm);
       
%         
        vhz(3:2:Emmm,3:2:Enmm,2:2:Epm)=(fhz(3:2:Emmm,3:2:Enmm,2:2:Epm)+...
            vcoef.rescoefpp1(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhz(3:2:Emmm,4:2:Enm,2:2:Epm)+vcoef.rescoefpm1(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhz(3:2:Emmm,2:2:Enmmm,2:2:Epm)+...
            vcoef.rescoefpp2(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhz(4:2:Emm,3:2:Enmm,2:2:Epm)+vcoef.rescoefpm2(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhz(2:2:Emmmm,3:2:Enmm,2:2:Epm)+...
            2*vcoef.rescoefpp3(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhz(3:2:Emmm,3:2:Enmm,3:2:Ep)+2*vcoef.rescoefpm3(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*vhz(3:2:Emmm,3:2:Enmm,1:2:Epmm)+...
            vcoef.viscpp1(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*(vhx(3:2:Emmm,4:2:Enm,3:2:Ep)-vhx(3:2:Emmm,4:2:Enm,1:2:Epmm))+...
            vcoef.viscpm1(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*(vhx(3:2:Emmm,2:2:Enmmm,1:2:Epmm)-vhx(3:2:Emmm,2:2:Enmmm,3:2:Ep))...
            +vcoef.viscpp2(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*(vhy(4:2:Emm,3:2:Enmm,3:2:Ep)-vhy(4:2:Emm,3:2:Enmm,1:2:Epmm))+...
            vcoef.viscpm2(2:2:Emmmm,2:2:Enmmm,1:2:Epmm).*(vhy(2:2:Emmmm,3:2:Enmm,1:2:Epmm)-vhy(2:2:Emmmm,3:2:Enmm,3:2:Ep))...
            )./vcoef.coefz(2:2:Emmmm,2:2:Enmmm,1:2:Epmm);
        
        vhz(3:2:Emmm,En,2:2:Epm)=(fhz(3:2:Emmm,En,2:2:Epm)+...
           vcoef.rescoefpp1boundR(2:2:Emmmm,1,1:2:Epmm).*vhz(3:2:Emmm,2,2:2:Epm)+vcoef.rescoefpm1boundR(2:2:Emmmm,1,1:2:Epmm).*vhz(3:2:Emmm,Enm,2:2:Epm)+...
           vcoef.rescoefpp2boundR(2:2:Emmmm,1,1:2:Epmm).*vhz(4:2:Emm,En,2:2:Epm)+vcoef.rescoefpm2boundR(2:2:Emmmm,1,1:2:Epmm).*vhz(2:2:Emmmm,En,2:2:Epm)+...
           2*vcoef.rescoefpp3boundR(2:2:Emmmm,1,1:2:Epmm).*vhz(3:2:Emmm,En,3:2:Ep)+2*vcoef.rescoefpm3boundR(2:2:Emmmm,1,1:2:Epmm).*vhz(3:2:Emmm,En,1:2:Epmm)+...
           vcoef.viscpp1(2:2:Emmmm,Enm,1:2:Epmm).*(vhx(3:2:Emmm,2,3:2:Ep)-vhx(3:2:Emmm,2,1:2:Epmm))+...
           vcoef.viscpm1(2:2:Emmmm,Enm,1:2:Epmm).*(vhx(3:2:Emmm,Enm,1:2:Epmm)-vhx(3:2:Emmm,Enm,3:2:Ep))...
           +vcoef.viscpp2(2:2:Emmmm,Enm,1:2:Epmm).*(vhy(4:2:Emm,En,3:2:Ep)-vhy(4:2:Emm,En,1:2:Epmm))+...
           vcoef.viscpm2(2:2:Emmmm,Enm,1:2:Epmm).*(vhy(2:2:Emmmm,En,1:2:Epmm)-vhy(2:2:Emmmm,En,3:2:Ep))...
           )./vcoef.coefzboundR(2:2:Emmmm,1,1:2:Epmm);
       vhz(3:2:Emmm,1,2:2:Epm)=vhz(3:2:Emmm,En,2:2:Epm);

%         %red odd pgs  uz
        vhz(2:2:Emm,3:2:Enmm,3:2:Epmm)=(fhz(2:2:Emm,3:2:Enmm,3:2:Epmm)+...
            vcoef.rescoefpp1(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhz(2:2:Emm,4:2:Enm,3:2:Epmm)+vcoef.rescoefpm1(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhz(2:2:Emm,2:2:Enmmm,3:2:Epmm)+...
            vcoef.rescoefpp2(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhz(3:2:Em,3:2:Enmm,3:2:Epmm)+vcoef.rescoefpm2(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhz(1:2:Emmm,3:2:Enmm,3:2:Epmm)+...
            2*vcoef.rescoefpp3(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhz(2:2:Emm,3:2:Enmm,4:2:Epm)+2*vcoef.rescoefpm3(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*vhz(2:2:Emm,3:2:Enmm,2:2:Epmmm)+...
            vcoef.viscpp1(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*(vhx(2:2:Emm,4:2:Enm,4:2:Epm)-vhx(2:2:Emm,4:2:Enm,2:2:Epmmm))+...
            vcoef.viscpm1(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*(vhx(2:2:Emm,2:2:Enmmm,2:2:Epmmm)-vhx(2:2:Emm,2:2:Enmmm,4:2:Epm))...
            +vcoef.viscpp2(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*(vhy(3:2:Em,3:2:Enmm,4:2:Epm)-vhy(3:2:Em,3:2:Enmm,2:2:Epmmm))+...
            vcoef.viscpm2(1:2:Emmm,2:2:Enmmm,2:2:Epmmm).*(vhy(1:2:Emmm,3:2:Enmm,2:2:Epmmm)-vhy(1:2:Emmm,3:2:Enmm,4:2:Epm))...
            )./vcoef.coefz(1:2:Emmm,2:2:Enmmm,2:2:Epmmm);
        
        vhz(2:2:Emm,En,3:2:Epmm)=(fhz(2:2:Emm,En,3:2:Epmm)+...
           vcoef.rescoefpp1boundR(1:2:Emmm,1,2:2:Epmmm).*vhz(2:2:Emm,2,3:2:Epmm)+vcoef.rescoefpm1boundR(1:2:Emmm,1,2:2:Epmmm).*vhz(2:2:Emm,Enm,3:2:Epmm)+...
           vcoef.rescoefpp2boundR(1:2:Emmm,1,2:2:Epmmm).*vhz(3:2:Em,En,3:2:Epmm)+vcoef.rescoefpm2boundR(1:2:Emmm,1,2:2:Epmmm).*vhz(1:2:Emmm,En,3:2:Epmm)+...
           2*vcoef.rescoefpp3boundR(1:2:Emmm,1,2:2:Epmmm).*vhz(2:2:Emm,En,4:2:Epm)+2*vcoef.rescoefpm3boundR(1:2:Emmm,1,2:2:Epmmm).*vhz(2:2:Emm,En,2:2:Epmmm)+...
           vcoef.viscpp1(1:2:Emmm,Enm,2:2:Epmmm).*(vhx(2:2:Emm,2,4:2:Epm)-vhx(2:2:Emm,2,2:2:Epmmm))+...
           vcoef.viscpm1(1:2:Emmm,Enm,2:2:Epmmm).*(vhx(2:2:Emm,Enm,2:2:Epmmm)-vhx(2:2:Emm,Enm,4:2:Epm))...
           +vcoef.viscpp2(1:2:Emmm,Enm,2:2:Epmmm).*(vhy(3:2:Em,En,4:2:Epm)-vhy(3:2:Em,En,2:2:Epmmm))+...
           vcoef.viscpm2(1:2:Emmm,Enm,2:2:Epmmm).*(vhy(1:2:Emmm,En,2:2:Epmmm)-vhy(1:2:Emmm,En,4:2:Epm))...
           )./vcoef.coefzboundR(1:2:Emmm,1,2:2:Epmmm);
       vhz(2:2:Emm,1,3:2:Epmm)=vhz(2:2:Emm,En,3:2:Epmm);
        
         vhz(2:2:Emm,3:2:Enmm,Ep)=(fhz(2:2:Emm,3:2:Enmm,Ep)+...
            vcoef.rescoefpp1boundF(1:2:Emmm,2:2:Enmmm).*vhz(2:2:Emm,4:2:Enm,Ep)+vcoef.rescoefpm1boundF(1:2:Emmm,2:2:Enmmm).*vhz(2:2:Emm,2:2:Enmmm,Ep)+...
            vcoef.rescoefpp2boundF(1:2:Emmm,2:2:Enmmm).*vhz(3:2:Em,3:2:Enmm,Ep)+vcoef.rescoefpm2boundF(1:2:Emmm,2:2:Enmm).*vhz(1:2:Emmm,3:2:Enmm,Ep)+...
            2*vcoef.rescoefpp3boundF(1:2:Emmm,2:2:Enmmm).*vhz(2:2:Emm,3:2:Enmm,2)+2*vcoef.rescoefpm3boundF(1:2:Emmm,2:2:Enmm).*vhz(2:2:Emm,3:2:Enmm,Epm)+...
            vcoef.viscpp1(1:2:Emmm,2:2:Enmmm,Epm).*(vhx(2:2:Emm,4:2:Enm,2)-vhx(2:2:Emm,4:2:Enm,Epm))+vcoef.viscpm1(1:2:Emmm,2:2:Enmmm,Epm).*(vhx(2:2:Emm,2:2:Enmmm,Epm)-vhx(2:2:Emm,2:2:Enmmm,2))...
            +vcoef.viscpp2(1:2:Emmm,2:2:Enmmm,Epm).*(vhy(3:2:Em,3:2:Enmm,2)-vhy(3:2:Em,3:2:Enmm,Epm))+vcoef.viscpm2(1:2:Emmm,2:2:Enmmm,Epm).*(vhy(1:2:Emmm,3:2:Enmm,Epm)-vhy(1:2:Emmm,3:2:Enmm,2))...
            )./vcoef.coefzboundF(1:2:Emmm,2:2:Enmmm);
        vhz(2:2:Emm,3:2:Enmm,1)=vhz(2:2:Emm,3:2:Enmm,Ep);
            
         vhz(2:2:Emm,En,Ep)=(fhz(2:2:Emm,En,Ep)+...
            vcoef.rescoefpp1boundFR(1:2:Emmm).*vhz(2:2:Emm,2,Ep)+vcoef.rescoefpm1boundFR(1:2:Emmm).*vhz(2:2:Emm,Enm,Ep)+...
            vcoef.rescoefpp2boundFR(1:2:Emmm).*vhz(3:2:Em,En,Ep)+vcoef.rescoefpm2boundFR(1:2:Emmm).*vhz(1:2:Emmm,En,Ep)+...
            2*vcoef.rescoefpp3boundFR(1:2:Emmm).*vhz(2:2:Emm,En,2)+2*vcoef.rescoefpm3boundFR(1:2:Emmm).*vhz(2:2:Emm,En,Epm)+...
            vcoef.viscpp1(1:2:Emmm,Enm,Epm).*(vhx(2:2:Emm,2,2)-vhx(2:2:Emm,2,Epm))+vcoef.viscpm1(1:2:Emmm,Enm,Epm).*(vhx(2:2:Emm,Enm,Epm)-vhx(2:2:Emm,Enm,2))...
            +vcoef.viscpp2(1:2:Emmm,Enm,Epm).*(vhy(3:2:Em,En,2)-vhy(3:2:Em,En,Epm))+vcoef.viscpm2(1:2:Emmm,Enm,Epm).*(vhy(1:2:Emmm,En,Epm)-vhy(1:2:Emmm,En,2))...
            )./vcoef.coefzboundFR(1:2:Emmm);
        vhz(2:2:Emm,1,1)=vhz(2:2:Emm,En,Ep);
        vhz(2:2:Emm,En,1)=vhz(2:2:Emm,En,Ep);
        vhz(2:2:Emm,1,Ep)=vhz(2:2:Emm,En,Ep);
         
        
        vhz(3:2:Emmm,2:2:Enm,3:2:Epmm)=(fhz(3:2:Emmm,2:2:Enm,3:2:Epmm)+...
            vcoef.rescoefpp1(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhz(3:2:Emmm,3:2:En,3:2:Epmm)+vcoef.rescoefpm1(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhz(3:2:Emmm,1:2:Enmm,3:2:Epmm)+...
            vcoef.rescoefpp2(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhz(4:2:Emm,2:2:Enm,3:2:Epmm)+vcoef.rescoefpm2(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhz(2:2:Emmmm,2:2:Enm,3:2:Epmm)+...
            2*vcoef.rescoefpp3(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhz(3:2:Emmm,2:2:Enm,4:2:Epm)+2*vcoef.rescoefpm3(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*vhz(3:2:Emmm,2:2:Enm,2:2:Epmmm)+...
            vcoef.viscpp1(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*(vhx(3:2:Emmm,3:2:En,4:2:Epm)-vhx(3:2:Emmm,3:2:En,2:2:Epmmm))+...
            vcoef.viscpm1(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*(vhx(3:2:Emmm,1:2:Enmm,2:2:Epmmm)-vhx(3:2:Emmm,1:2:Enmm,4:2:Epm))...
            +vcoef.viscpp2(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*(vhy(4:2:Emm,2:2:Enm,4:2:Epm)-vhy(4:2:Emm,2:2:Enm,2:2:Epmmm))+...
            vcoef.viscpm2(2:2:Emmmm,1:2:Enmm,2:2:Epmmm).*(vhy(2:2:Emmmm,2:2:Enm,2:2:Epmmm)-vhy(2:2:Emmmm,2:2:Enm,4:2:Epm))...
            )./vcoef.coefz(2:2:Emmmm,1:2:Enmm,2:2:Epmmm);
        
         vhz(3:2:Emmm,2:2:Enm,Ep)=(fhz(3:2:Emmm,2:2:Enm,Ep)+...
            vcoef.rescoefpp1boundF(2:2:Emmmm,1:2:Enmm).*vhz(3:2:Emmm,3:2:En,Ep)+vcoef.rescoefpm1boundF(2:2:Emmmm,1:2:Enmm).*vhz(3:2:Emmm,1:2:Enmm,Ep)+...
            vcoef.rescoefpp2boundF(2:2:Emmmm,1:2:Enmm).*vhz(4:2:Emm,2:2:Enm,Ep)+vcoef.rescoefpm2boundF(2:2:Emmmm,1:2:Enmm).*vhz(2:2:Emmmm,2:2:Enm,Ep)+...
            2*vcoef.rescoefpp3boundF(2:2:Emmmm,1:2:Enmm).*vhz(3:2:Emmm,2:2:Enm,2)+2*vcoef.rescoefpm3boundF(2:2:Emmmm,1:2:Enmm).*vhz(3:2:Emmm,2:2:Enm,Epm)+...
            vcoef.viscpp1(2:2:Emmmm,1:2:Enmm,Epm).*(vhx(3:2:Emmm,3:2:En,2)-vhx(3:2:Emmm,3:2:En,Epm))+vcoef.viscpm1(2:2:Emmmm,1:2:Enmm,Epm).*(vhx(3:2:Emmm,1:2:Enmm,Epm)-vhx(3:2:Emmm,1:2:Enmm,2))...
            +vcoef.viscpp2(2:2:Emmmm,1:2:Enmm,Epm).*(vhy(4:2:Emm,2:2:Enm,2)-vhy(4:2:Emm,2:2:Enm,Epm))+vcoef.viscpm2(2:2:Emmmm,1:2:Enmm,Epm).*(vhy(2:2:Emmmm,2:2:Enm,Epm)-vhy(2:2:Emmmm,2:2:Enm,2))...
            )./vcoef.coefzboundF(2:2:Emmmm,1:2:Enmm);
            vhz(3:2:Emmm,2:2:Enm,1)=vhz(3:2:Emmm,2:2:Enm,Ep);
%         

%         
        %black even pgs
        vhx(2:2:Emm,3:2:Enmm,2:2:Epm)=(fhx(2:2:Emm,3:2:Enmm,2:2:Epm)+...
            2*vcoef.rescoefpp1(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhx(2:2:Emm,4:2:Enm,2:2:Epm)+2*vcoef.rescoefpm1(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhx(2:2:Emm,2:2:Enmmm,2:2:Epm)+...
            vcoef.rescoefpp2(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhx(3:2:Em,3:2:Enmm,2:2:Epm)+vcoef.rescoefpm2(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhx(1:2:Emmm,3:2:Enmm,2:2:Epm)+...
            vcoef.rescoefpp3(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhx(2:2:Emm,3:2:Enmm,3:2:Ep)+vcoef.rescoefpm3(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhx(2:2:Emm,3:2:Enmm,1:2:Epmm)+...
            vcoef.viscpp2(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*(vhy(3:2:Em,4:2:Enm,2:2:Epm)-vhy(3:2:Em,2:2:Enmmm,2:2:Epm))+...
            vcoef.viscpm2(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*(vhy(1:2:Emmm,2:2:Enmmm,2:2:Epm)-vhy(1:2:Emmm,4:2:Enm,2:2:Epm))...
            +vcoef.viscpp3(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*(vhz(2:2:Emm,4:2:Enm,3:2:Ep)-vhz(2:2:Emm,2:2:Enmmm,3:2:Ep))+...
            vcoef.viscpm3(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*(vhz(2:2:Emm,2:2:Enmmm,1:2:Epmm)-vhz(2:2:Emm,4:2:Enm,1:2:Epmm)))./vcoef.coefx(1:2:Emmm,2:2:Enmmm,1:2:Epmm);
        
        vhx(2:2:Emm,En,2:2:Epm)=(fhx(2:2:Emm,En,2:2:Epm)+...
           2*vcoef.rescoefpp1boundR(1:2:Emmm,1,1:2:Epmm).*vhx(2:2:Emm,2,2:2:Epm)+2*vcoef.rescoefpm1boundR(1:2:Emmm,1,1:2:Epmm).*vhx(2:2:Emm,Enm,2:2:Epm)+...
           vcoef.rescoefpp2boundR(1:2:Emmm,1,1:2:Epmm).*vhx(3:2:Em,En,2:2:Epm)+vcoef.rescoefpm2boundR(1:2:Emmm,1,1:2:Epmm).*vhx(1:2:Emmm,En,2:2:Epm)+...
           vcoef.rescoefpp3boundR(1:2:Emmm,1,1:2:Epmm).*vhx(2:2:Emm,En,3:2:Ep)+vcoef.rescoefpm3boundR(1:2:Emmm,1,1:2:Epmm).*vhx(2:2:Emm,En,1:2:Epmm)+...
           vcoef.viscpp2(1:2:Emmm,Enm,1:2:Epmm).*(vhy(3:2:Em,2,2:2:Epm)-vhy(3:2:Em,Enm,2:2:Epm))+...
           vcoef.viscpm2(1:2:Emmm,Enm,1:2:Epmm).*(vhy(1:2:Emmm,Enm,2:2:Epm)-vhy(1:2:Emmm,2,2:2:Epm))...
           +vcoef.viscpp3(1:2:Emmm,Enm,1:2:Epmm).*(vhz(2:2:Emm,2,3:2:Ep)-vhz(2:2:Emm,Enm,3:2:Ep))+...
           vcoef.viscpm3(1:2:Emmm,Enm,1:2:Epmm).*(vhz(2:2:Emm,Enm,1:2:Epmm)-vhz(2:2:Emm,2,1:2:Epmm)))./vcoef.coefxboundR(1:2:Emmm,1,1:2:Epmm);
        vhx(2:2:Emm,1,2:2:Epm)=vhx(2:2:Emm,En,2:2:Epm);
        
        vhx(3:2:Emmm,2:2:Enm,2:2:Epm)=(fhx(3:2:Emmm,2:2:Enm,2:2:Epm)+...
            2*vcoef.rescoefpp1(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhx(3:2:Emmm,3:2:En,2:2:Epm)+2*vcoef.rescoefpm1(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhx(3:2:Emmm,1:2:Enmm,2:2:Epm)+...
            vcoef.rescoefpp2(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhx(4:2:Emm,2:2:Enm,2:2:Epm)+vcoef.rescoefpm2(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhx(2:2:Emmmm,2:2:Enm,2:2:Epm)+...
            vcoef.rescoefpp3(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhx(3:2:Emmm,2:2:Enm,3:2:Ep)+vcoef.rescoefpm3(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhx(3:2:Emmm,2:2:Enm,1:2:Epmm)+...
            vcoef.viscpp2(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*(vhy(4:2:Emm,3:2:En,2:2:Epm)-vhy(4:2:Emm,1:2:Enmm,2:2:Epm))+...
            vcoef.viscpm2(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*(vhy(2:2:Emmmm,1:2:Enmm,2:2:Epm)-vhy(2:2:Emmmm,3:2:En,2:2:Epm))...
            +vcoef.viscpp3(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*(vhz(3:2:Emmm,3:2:En,3:2:Ep)-vhz(3:2:Emmm,1:2:Enmm,3:2:Ep))+...
            vcoef.viscpm3(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*(vhz(3:2:Emmm,1:2:Enmm,1:2:Epmm)-vhz(3:2:Emmm,3:2:En,1:2:Epmm)))./vcoef.coefx(2:2:Emmmm,1:2:Enmm,1:2:Epmm);
%         
%         %black odd pgs
        vhx(2:2:Emm,2:2:Enm,3:2:Epmm)=(fhx(2:2:Emm,2:2:Enm,3:2:Epmm)+...
            2*vcoef.rescoefpp1(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhx(2:2:Emm,3:2:En,3:2:Epmm)+2*vcoef.rescoefpm1(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhx(2:2:Emm,1:2:Enmm,3:2:Epmm)+...
            vcoef.rescoefpp2(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhx(3:2:Em,2:2:Enm,3:2:Epmm)+vcoef.rescoefpm2(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhx(1:2:Emmm,2:2:Enm,3:2:Epmm)+...
            vcoef.rescoefpp3(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhx(2:2:Emm,2:2:Enm,4:2:Epm)+vcoef.rescoefpm3(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhx(2:2:Emm,2:2:Enm,2:2:Epmmm)+...
            vcoef.viscpp2(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*(vhy(3:2:Em,3:2:En,3:2:Epmm)-vhy(3:2:Em,1:2:Enmm,3:2:Epmm))+...
            vcoef.viscpm2(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*(vhy(1:2:Emmm,1:2:Enmm,3:2:Epmm)-vhy(1:2:Emmm,3:2:En,3:2:Epmm))...
            +vcoef.viscpp3(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*(vhz(2:2:Emm,3:2:En,4:2:Epm)-vhz(2:2:Emm,1:2:Enmm,4:2:Epm))+...
            vcoef.viscpm3(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*(vhz(2:2:Emm,1:2:Enmm,2:2:Epmmm)-vhz(2:2:Emm,3:2:En,2:2:Epmmm)))./vcoef.coefx(1:2:Emmm,1:2:Enmm,2:2:Epmmm);
        
       vhx(2:2:Emm,2:2:Enm,Ep)=(fhx(2:2:Emm,2:2:Enm,Ep)+...
            2*vcoef.rescoefpp1boundF(1:2:Emmm,1:2:Enmm).*vhx(2:2:Emm,3:2:En,Ep)+2*vcoef.rescoefpm1boundF(1:2:Emmm,1:2:Enmm).*vhx(2:2:Emm,1:2:Enmm,Ep)+...
            vcoef.rescoefpp2boundF(1:2:Emmm,1:2:Enmm).*vhx(3:2:Em,2:2:Enm,Ep)+vcoef.rescoefpm2boundF(1:2:Emmm,1:2:Enmm).*vhx(1:2:Emmm,2:2:Enm,Ep)+...
            vcoef.rescoefpp3boundF(1:2:Emmm,1:2:Enmm).*vhx(2:2:Emm,2:2:Enm,2)+vcoef.rescoefpm3boundF(1:2:Emmm,1:2:Enmm).*vhx(2:2:Emm,2:2:Enm,Epm)+...
            vcoef.viscpp2(1:2:Emmm,1:2:Enmm,Epm).*(vhy(3:2:Em,3:2:En,Ep)-vhy(3:2:Em,1:2:Enmm,Ep))+vcoef.viscpm2(1:2:Emmm,1:2:Enmm,Epm).*(vhy(1:2:Emmm,1:2:Enmm,Ep)-vhy(1:2:Emmm,3:2:En,Ep))...
            +vcoef.viscpp3(1:2:Emmm,1:2:Enmm,Epm).*(vhz(2:2:Emm,3:2:En,2)-vhz(2:2:Emm,1:2:Enmm,2))+vcoef.viscpm3(1:2:Emmm,1:2:Enmm,Epm).*(vhz(2:2:Emm,1:2:Enmm,Epm)-vhz(2:2:Emm,3:2:En,Epm)))./vcoef.coefxboundF(1:2:Emmm,1:2:Enmm);
        vhx(2:2:Emm,2:2:Enm,1)=vhx(2:2:Emm,2:2:Enm,Ep);
        
        
        vhx(3:2:Emmm,3:2:Enmm,3:2:Epmm)=(fhx(3:2:Emmm,3:2:Enmm,3:2:Epmm)+...
            2*vcoef.rescoefpp1(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhx(3:2:Emmm,4:2:Enm,3:2:Epmm)+2*vcoef.rescoefpm1(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhx(3:2:Emmm,2:2:Enmmm,3:2:Epmm)+...
            vcoef.rescoefpp2(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhx(4:2:Emm,3:2:Enmm,3:2:Epmm)+vcoef.rescoefpm2(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhx(2:2:Emmmm,3:2:Enmm,3:2:Epmm)+...
            vcoef.rescoefpp3(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhx(3:2:Emmm,3:2:Enmm,4:2:Epm)+vcoef.rescoefpm3(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhx(3:2:Emmm,3:2:Enmm,2:2:Epmmm)+...
            vcoef.viscpp2(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*(vhy(4:2:Emm,4:2:Enm,3:2:Epmm)-vhy(4:2:Emm,2:2:Enmmm,3:2:Epmm))+...
            vcoef.viscpm2(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*(vhy(2:2:Emmmm,2:2:Enmmm,3:2:Epmm)-vhy(2:2:Emmmm,4:2:Enm,3:2:Epmm))...
            +vcoef.viscpp3(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*(vhz(3:2:Emmm,4:2:Enm,4:2:Epm)-vhz(3:2:Emmm,2:2:Enmmm,4:2:Epm))+...
            vcoef.viscpm3(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*(vhz(3:2:Emmm,2:2:Enmmm,2:2:Epmmm)-vhz(3:2:Emmm,4:2:Enm,2:2:Epmmm)))./vcoef.coefx(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm);
        
        
        vhx(3:2:Emmm,En,3:2:Epmm)=(fhx(3:2:Emmm,En,3:2:Epmm)+...
           2*vcoef.rescoefpp1boundR(2:2:Emmmm,1,2:2:Epmmm).*vhx(3:2:Emmm,2,3:2:Epmm)+2*vcoef.rescoefpm1boundR(2:2:Emmmm,1,2:2:Epmmm).*vhx(3:2:Emmm,Enm,3:2:Epmm)+...
           vcoef.rescoefpp2boundR(2:2:Emmmm,1,2:2:Epmmm).*vhx(4:2:Emm,En,3:2:Epmm)+vcoef.rescoefpm2boundR(2:2:Emmmm,1,2:2:Epmmm).*vhx(2:2:Emmmm,En,3:2:Epmm)+...
           vcoef.rescoefpp3boundR(2:2:Emmmm,1,2:2:Epmmm).*vhx(3:2:Emmm,En,4:2:Epm)+vcoef.rescoefpm3boundR(2:2:Emmmm,1,2:2:Epmmm).*vhx(3:2:Emmm,En,2:2:Epmmm)+...
           vcoef.viscpp2(2:2:Emmmm,Enm,2:2:Epmmm).*(vhy(4:2:Emm,2,3:2:Epmm)-vhy(4:2:Emm,Enm,3:2:Epmm))+...
           vcoef.viscpm2(2:2:Emmmm,Enm,2:2:Epmmm).*(vhy(2:2:Emmmm,Enm,3:2:Epmm)-vhy(2:2:Emmmm,2,3:2:Epmm))...
           +vcoef.viscpp3(2:2:Emmmm,Enm,2:2:Epmmm).*(vhz(3:2:Emmm,2,4:2:Epm)-vhz(3:2:Emmm,Enm,4:2:Epm))+...
           vcoef.viscpm3(2:2:Emmmm,Enm,2:2:Epmmm).*(vhz(3:2:Emmm,Enm,2:2:Epmmm)-vhz(3:2:Emmm,2,2:2:Epmmm)))./vcoef.coefxboundR(2:2:Emmmm,1,2:2:Epmmm);
        vhx(3:2:Emmm,1,3:2:Epmm)=vhx(3:2:Emmm,En,3:2:Epmm);
        
        
        vhx(3:2:Emmm,3:2:Enmm,Ep)=(fhx(3:2:Emmm,3:2:Enmm,Ep)+...
            2*vcoef.rescoefpp1boundF(2:2:Emmmm,2:2:Enmmm).*vhx(3:2:Emmm,4:2:Enm,Ep)+2*vcoef.rescoefpm1boundF(2:2:Emmmm,2:2:Enmmm).*vhx(3:2:Emmm,2:2:Enmmm,Ep)+...
            vcoef.rescoefpp2boundF(2:2:Emmmm,2:2:Enmmm).*vhx(4:2:Emm,3:2:Enmm,Ep)+vcoef.rescoefpm2boundF(2:2:Emmmm,2:2:Enmmm).*vhx(2:2:Emmmm,3:2:Enmm,Ep)+...
            vcoef.rescoefpp3boundF(2:2:Emmmm,2:2:Enmmm).*vhx(3:2:Emmm,3:2:Enmm,2)+vcoef.rescoefpm3boundF(2:2:Emmmm,2:2:Enmmm).*vhx(3:2:Emmm,3:2:Enmm,Epm)+...
            vcoef.viscpp2(2:2:Emmmm,2:2:Enmmm,Epm).*(vhy(4:2:Emm,4:2:Enm,Ep)-vhy(4:2:Emm,2:2:Enmmm,Ep))+vcoef.viscpm2(2:2:Emmmm,2:2:Enmmm,Epm).*(vhy(2:2:Emmmm,2:2:Enmmm,Ep)-vhy(2:2:Emmmm,4:2:Enm,Ep))...
            +vcoef.viscpp3(2:2:Emmmm,2:2:Enmmm,Epm).*(vhz(3:2:Emmm,4:2:Enm,2)-vhz(3:2:Emmm,2:2:Enmmm,2))+vcoef.viscpm3(2:2:Emmmm,2:2:Enmmm,Epm).*(vhz(3:2:Emmm,2:2:Enmmm,Epm)-vhz(3:2:Emmm,4:2:Enm,Epm)))./vcoef.coefxboundF(2:2:Emmmm,2:2:Enmmm);
       vhx(3:2:Emmm,3:2:Enmm,1)=vhx(3:2:Emmm,3:2:Enmm,Ep);
       
        vhx(3:2:Emmm,En,Ep)=(fhx(3:2:Emmm,En,Ep)+...
            2*vcoef.rescoefpp1boundFR(2:2:Emmmm).*vhx(3:2:Emmm,2,Ep)+2*vcoef.rescoefpm1boundFR(2:2:Emmmm).*vhx(3:2:Emmm,Enm,Ep)+...
            vcoef.rescoefpp2boundFR(2:2:Emmmm).*vhx(4:2:Emm,En,Ep)+vcoef.rescoefpm2boundFR(2:2:Emmmm).*vhx(2:2:Emmmm,En,Ep)+...
            vcoef.rescoefpp3boundFR(2:2:Emmmm).*vhx(3:2:Emmm,En,2)+vcoef.rescoefpm3boundFR(2:2:Emmmm).*vhx(3:2:Emmm,En,Epm)+...
            vcoef.viscpp2(2:2:Emmmm,Enm,Epm).*(vhy(4:2:Emm,2,Ep)-vhy(4:2:Emm,Enm,Ep))+vcoef.viscpm2(2:2:Emmmm,Enm,Epm).*(vhy(2:2:Emmmm,Enm,Ep)-vhy(2:2:Emmmm,2,Ep))...
            +vcoef.viscpp3(2:2:Emmmm,Enm,Epm).*(vhz(3:2:Emmm,2,2)-vhz(3:2:Emmm,Enm,2))+vcoef.viscpm3(2:2:Emmmm,Enm,Epm).*(vhz(3:2:Emmm,Enm,Epm)-vhz(3:2:Emmm,2,Epm)))./vcoef.coefxboundFR(2:2:Emmmm);
       vhx(3:2:Emmm,1,1)=vhx(3:2:Emmm,En,Ep);
       vhx(3:2:Emmm,En,1)=vhx(3:2:Emmm,En,Ep);
       vhx(3:2:Emmm,1,Ep)=vhx(3:2:Emmm,En,Ep);
%         

        
        
        
        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   y vel
        
                
%         black even pgs
        vhy(2:2:Emm,3:2:Enmm,2:2:Epm)=(fhy(2:2:Emm,3:2:Enmm,2:2:Epm)+...
            vcoef.rescoefpp1(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhy(2:2:Emm,4:2:Enm,2:2:Epm)+vcoef.rescoefpm1(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhy(2:2:Emm,2:2:Enmmm,2:2:Epm)+...
            2*vcoef.rescoefpp2(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhy(3:2:Em,3:2:Enmm,2:2:Epm)+2*vcoef.rescoefpm2(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhy(1:2:Emmm,3:2:Enmm,2:2:Epm)+...
            vcoef.rescoefpp3(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhy(2:2:Emm,3:2:Enmm,3:2:Ep)+vcoef.rescoefpm3(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhy(2:2:Emm,3:2:Enmm,1:2:Epmm)+...
            vcoef.viscpp1(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*(vhx(3:2:Em,4:2:Enm,2:2:Epm)-vhx(1:2:Emmm,4:2:Enm,2:2:Epm))+...
            vcoef.viscpm1(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*(vhx(1:2:Emmm,2:2:Enmmm,2:2:Epm)-vhx(3:2:Em,2:2:Enmmm,2:2:Epm))...
            +vcoef.viscpp3(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*(vhz(3:2:Em,3:2:Enmm,3:2:Ep)-vhz(1:2:Emmm,3:2:Enmm,3:2:Ep))+...
            vcoef.viscpm3(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*(vhz(1:2:Emmm,3:2:Enmm,1:2:Epmm)-vhz(3:2:Em,3:2:Enmm,1:2:Epmm)))./vcoef.coefy(1:2:Emmm,2:2:Enmmm,1:2:Epmm);
        
        vhy(2:2:Emm,En,2:2:Epm)=(fhy(2:2:Emm,En,2:2:Epm)+...
           vcoef.rescoefpp1boundR(1:2:Emmm,1,1:2:Epmm).*vhy(2:2:Emm,2,2:2:Epm)+vcoef.rescoefpm1boundR(1:2:Emmm,1,1:2:Epmm).*vhy(2:2:Emm,Enm,2:2:Epm)+...
           2*vcoef.rescoefpp2boundR(1:2:Emmm,1,1:2:Epmm).*vhy(3:2:Em,En,2:2:Epm)+2*vcoef.rescoefpm2boundR(1:2:Emmm,1,1:2:Epmm).*vhy(1:2:Emmm,En,2:2:Epm)+...
           vcoef.rescoefpp3boundR(1:2:Emmm,1,1:2:Epmm).*vhy(2:2:Emm,En,3:2:Ep)+vcoef.rescoefpm3boundR(1:2:Emmm,1,1:2:Epmm).*vhy(2:2:Emm,En,1:2:Epmm)+...
           vcoef.viscpp1(1:2:Emmm,Enm,1:2:Epmm).*(vhx(3:2:Em,2,2:2:Epm)-vhx(1:2:Emmm,2,2:2:Epm))+...
           vcoef.viscpm1(1:2:Emmm,Enm,1:2:Epmm).*(vhx(1:2:Emmm,Enm,2:2:Epm)-vhx(3:2:Em,Enm,2:2:Epm))...
           +vcoef.viscpp3(1:2:Emmm,Enm,1:2:Epmm).*(vhz(3:2:Em,En,3:2:Ep)-vhz(1:2:Emmm,En,3:2:Ep))+...
           vcoef.viscpm3(1:2:Emmm,Enm,1:2:Epmm).*(vhz(1:2:Emmm,En,1:2:Epmm)-vhz(3:2:Em,En,1:2:Epmm)))./vcoef.coefyboundR(1:2:Emmm,1,1:2:Epmm);
        vhy(2:2:Emm,1,2:2:Epm)=vhy(2:2:Emm,En,2:2:Epm);
        
        
        vhy(3:2:Emmm,2:2:Enm,2:2:Epm)=(fhy(3:2:Emmm,2:2:Enm,2:2:Epm)+...
            vcoef.rescoefpp1(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhy(3:2:Emmm,3:2:En,2:2:Epm)+vcoef.rescoefpm1(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhy(3:2:Emmm,1:2:Enmm,2:2:Epm)+...
            2*vcoef.rescoefpp2(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhy(4:2:Emm,2:2:Enm,2:2:Epm)+2*vcoef.rescoefpm2(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhy(2:2:Emmmm,2:2:Enm,2:2:Epm)+...
            vcoef.rescoefpp3(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhy(3:2:Emmm,2:2:Enm,3:2:Ep)+vcoef.rescoefpm3(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhy(3:2:Emmm,2:2:Enm,1:2:Epmm)+...
            vcoef.viscpp1(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*(vhx(4:2:Emm,3:2:En,2:2:Epm)-vhx(2:2:Emmmm,3:2:En,2:2:Epm))+...
            vcoef.viscpm1(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*(vhx(2:2:Emmmm,1:2:Enmm,2:2:Epm)-vhx(4:2:Emm,1:2:Enmm,2:2:Epm))...
            +vcoef.viscpp3(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*(vhz(4:2:Emm,2:2:Enm,3:2:Ep)-vhz(2:2:Emmmm,2:2:Enm,3:2:Ep))+...
            vcoef.viscpm3(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*(vhz(2:2:Emmmm,2:2:Enm,1:2:Epmm)-vhz(4:2:Emm,2:2:Enm,1:2:Epmm)))./vcoef.coefy(2:2:Emmmm,1:2:Enmm,1:2:Epmm);
%         
%         %black odd pgs
        vhy(2:2:Emm,2:2:Enm,3:2:Epmm)=(fhy(2:2:Emm,2:2:Enm,3:2:Epmm)+...
            vcoef.rescoefpp1(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhy(2:2:Emm,3:2:En,3:2:Epmm)+vcoef.rescoefpm1(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhy(2:2:Emm,1:2:Enmm,3:2:Epmm)+...
            2*vcoef.rescoefpp2(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhy(3:2:Em,2:2:Enm,3:2:Epmm)+2*vcoef.rescoefpm2(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhy(1:2:Emmm,2:2:Enm,3:2:Epmm)+...
            vcoef.rescoefpp3(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhy(2:2:Emm,2:2:Enm,4:2:Epm)+vcoef.rescoefpm3(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhy(2:2:Emm,2:2:Enm,2:2:Epmmm)+...
            vcoef.viscpp1(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*(vhx(3:2:Em,3:2:En,3:2:Epmm)-vhx(1:2:Emmm,3:2:En,3:2:Epmm))+...
            vcoef.viscpm1(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*(vhx(1:2:Emmm,1:2:Enmm,3:2:Epmm)-vhx(3:2:Em,1:2:Enmm,3:2:Epmm))...
            +vcoef.viscpp3(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*(vhz(3:2:Em,2:2:Enm,4:2:Epm)-vhz(1:2:Emmm,2:2:Enm,4:2:Epm))+...
            vcoef.viscpm3(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*(vhz(1:2:Emmm,2:2:Enm,2:2:Epmmm)-vhz(3:2:Em,2:2:Enm,2:2:Epmmm)))./vcoef.coefy(1:2:Emmm,1:2:Enmm,2:2:Epmmm);
        
        vhy(2:2:Emm,2:2:Enm,Ep)=(fhy(2:2:Emm,2:2:Enm,Ep)+...
            vcoef.rescoefpp1boundF(1:2:Emmm,1:2:Enmm).*vhy(2:2:Emm,3:2:En,Ep)+vcoef.rescoefpm1boundF(1:2:Emmm,1:2:Enmm).*vhy(2:2:Emm,1:2:Enmm,Ep)+...
            2*vcoef.rescoefpp2boundF(1:2:Emmm,1:2:Enmm).*vhy(3:2:Em,2:2:Enm,Ep)+2*vcoef.rescoefpm2boundF(1:2:Emmm,1:2:Enmm).*vhy(1:2:Emmm,2:2:Enm,Ep)+...
            vcoef.rescoefpp3boundF(1:2:Emmm,1:2:Enmm).*vhy(2:2:Emm,2:2:Enm,2)+vcoef.rescoefpm3boundF(1:2:Emmm,1:2:Enmm).*vhy(2:2:Emm,2:2:Enm,Epm)+...
            vcoef.viscpp1(1:2:Emmm,1:2:Enmm,Epm).*(vhx(3:2:Em,3:2:En,Ep)-vhx(1:2:Emmm,3:2:En,Ep))+vcoef.viscpm1(1:2:Emmm,1:2:Enmm,Epm).*(vhx(1:2:Emmm,1:2:Enmm,Ep)-vhx(3:2:Em,1:2:Enmm,Ep))...
            +vcoef.viscpp3(1:2:Emmm,1:2:Enmm,Epm).*(vhz(3:2:Em,2:2:Enm,2)-vhz(1:2:Emmm,2:2:Enm,2))+vcoef.viscpm3(1:2:Emmm,1:2:Enmm,Epm).*(vhz(1:2:Emmm,2:2:Enm,Epm)-vhz(3:2:Em,2:2:Enm,Epm)))./vcoef.coefyboundF(1:2:Emmm,1:2:Enmm);
        vhy(2:2:Emm,2:2:Enm,1)=vhy(2:2:Emm,2:2:Enm,Ep); 
        
        vhy(3:2:Emmm,3:2:Enmm,3:2:Epmm)=(fhy(3:2:Emmm,3:2:Enmm,3:2:Epmm)+...
            vcoef.rescoefpp1(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhy(3:2:Emmm,4:2:Enm,3:2:Epmm)+vcoef.rescoefpm1(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhy(3:2:Emmm,2:2:Enmmm,3:2:Epmm)+...
            2*vcoef.rescoefpp2(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhy(4:2:Emm,3:2:Enmm,3:2:Epmm)+2*vcoef.rescoefpm2(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhy(2:2:Emmmm,3:2:Enmm,3:2:Epmm)+...
            vcoef.rescoefpp3(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhy(3:2:Emmm,3:2:Enmm,4:2:Epm)+vcoef.rescoefpm3(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhy(3:2:Emmm,3:2:Enmm,2:2:Epmmm)+...
            vcoef.viscpp1(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*(vhx(4:2:Emm,4:2:Enm,3:2:Epmm)-vhx(2:2:Emmmm,4:2:Enm,3:2:Epmm))+...
            vcoef.viscpm1(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*(vhx(2:2:Emmmm,2:2:Enmmm,3:2:Epmm)-vhx(4:2:Emm,2:2:Enmmm,3:2:Epmm))...
            +vcoef.viscpp3(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*(vhz(4:2:Emm,3:2:Enmm,4:2:Epm)-vhz(2:2:Emmmm,3:2:Enmm,4:2:Epm))+...
            vcoef.viscpm3(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*(vhz(2:2:Emmmm,3:2:Enmm,2:2:Epmmm)-vhz(4:2:Emm,3:2:Enmm,2:2:Epmmm)))./vcoef.coefy(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm);
        
        vhy(3:2:Emmm,En,3:2:Epmm)=(fhy(3:2:Emmm,En,3:2:Epmm)+...
           vcoef.rescoefpp1boundR(2:2:Emmmm,1,2:2:Epmmm).*vhy(3:2:Emmm,2,3:2:Epmm)+vcoef.rescoefpm1boundR(2:2:Emmmm,1,2:2:Epmmm).*vhy(3:2:Emmm,Enm,3:2:Epmm)+...
           2*vcoef.rescoefpp2boundR(2:2:Emmmm,1,2:2:Epmmm).*vhy(4:2:Emm,En,3:2:Epmm)+2*vcoef.rescoefpm2boundR(2:2:Emmmm,1,2:2:Epmmm).*vhy(2:2:Emmmm,En,3:2:Epmm)+...
           vcoef.rescoefpp3boundR(2:2:Emmmm,1,2:2:Epmmm).*vhy(3:2:Emmm,En,4:2:Epm)+vcoef.rescoefpm3boundR(2:2:Emmmm,1,2:2:Epmmm).*vhy(3:2:Emmm,En,2:2:Epmmm)+...
           vcoef.viscpp1(2:2:Emmmm,Enm,2:2:Epmmm).*(vhx(4:2:Emm,2,3:2:Epmm)-vhx(2:2:Emmmm,2,3:2:Epmm))+...
           vcoef.viscpm1(2:2:Emmmm,Enm,2:2:Epmmm).*(vhx(2:2:Emmmm,Enm,3:2:Epmm)-vhx(4:2:Emm,Enm,3:2:Epmm))...
           +vcoef.viscpp3(2:2:Emmmm,Enm,2:2:Epmmm).*(vhz(4:2:Emm,En,4:2:Epm)-vhz(2:2:Emmmm,En,4:2:Epm))+...
           vcoef.viscpm3(2:2:Emmmm,Enm,2:2:Epmmm).*(vhz(2:2:Emmmm,En,2:2:Epmmm)-vhz(4:2:Emm,En,2:2:Epmmm)))./vcoef.coefyboundR(2:2:Emmmm,1,2:2:Epmmm);
        vhy(3:2:Emmm,1,3:2:Epmm)=vhy(3:2:Emmm,En,3:2:Epmm);
        
        
        vhy(3:2:Emmm,3:2:Enmm,Ep)=(fhy(3:2:Emmm,3:2:Enmm,Ep)+...
            vcoef.rescoefpp1boundF(2:2:Emmmm,2:2:Enmmm).*vhy(3:2:Emmm,4:2:Enm,Ep)+vcoef.rescoefpm1boundF(2:2:Emmmm,2:2:Enmmm).*vhy(3:2:Emmm,2:2:Enmmm,Ep)+...
            2*vcoef.rescoefpp2boundF(2:2:Emmmm,2:2:Enmmm).*vhy(4:2:Emm,3:2:Enmm,Ep)+2*vcoef.rescoefpm2boundF(2:2:Emmmm,2:2:Enmmm).*vhy(2:2:Emmmm,3:2:Enmm,Ep)+...
            vcoef.rescoefpp3boundF(2:2:Emmmm,2:2:Enmmm).*vhy(3:2:Emmm,3:2:Enmm,2)+vcoef.rescoefpm3boundF(2:2:Emmmm,2:2:Enmmm).*vhy(3:2:Emmm,3:2:Enmm,Epm)+...
            vcoef.viscpp1(2:2:Emmmm,2:2:Enmmm,Epm).*(vhx(4:2:Emm,4:2:Enm,Ep)-vhx(2:2:Emmmm,4:2:Enm,Ep))+vcoef.viscpm1(2:2:Emmmm,2:2:Enmmm,Epm).*(vhx(2:2:Emmmm,2:2:Enmmm,Ep)-vhx(4:2:Emm,2:2:Enmmm,Ep))...
            +vcoef.viscpp3(2:2:Emmmm,2:2:Enmmm,Epm).*(vhz(4:2:Emm,3:2:Enmm,2)-vhz(2:2:Emmmm,3:2:Enmm,2))+vcoef.viscpm3(2:2:Emmmm,2:2:Enmmm,Epm).*(vhz(2:2:Emmmm,3:2:Enmm,Epm)-vhz(4:2:Emm,3:2:Enmm,Epm)))./vcoef.coefyboundF(2:2:Emmmm,2:2:Enmmm);
        vhy(3:2:Emmm,3:2:Enmm,1)=vhy(3:2:Emmm,3:2:Enmm,Ep);
        
        vhy(3:2:Emmm,En,Ep)=(fhy(3:2:Emmm,En,Ep)+...
           vcoef.rescoefpp1boundFR(2:2:Emmmm).*vhy(3:2:Emmm,2,Ep)+vcoef.rescoefpm1boundFR(2:2:Emmmm).*vhy(3:2:Emmm,Enm,Ep)+...
           2*vcoef.rescoefpp2boundFR(2:2:Emmmm).*vhy(4:2:Emm,En,Ep)+2*vcoef.rescoefpm2boundFR(2:2:Emmmm).*vhy(2:2:Emmmm,En,Ep)+...
           vcoef.rescoefpp3boundFR(2:2:Emmmm).*vhy(3:2:Emmm,En,2)+vcoef.rescoefpm3boundFR(2:2:Emmmm).*vhy(3:2:Emmm,En,Epm)+...
           vcoef.viscpp1(2:2:Emmmm,Enm,Epm).*(vhx(4:2:Emm,2,Ep)-vhx(2:2:Emmmm,2,Ep))+vcoef.viscpm1(2:2:Emmmm,Enm,Epm).*(vhx(2:2:Emmmm,Enm,Ep)-vhx(4:2:Emm,Enm,Ep))...
           +vcoef.viscpp3(2:2:Emmmm,Enm,Epm).*(vhz(4:2:Emm,En,2)-vhz(2:2:Emmmm,En,2))+vcoef.viscpm3(2:2:Emmmm,Enm,Epm).*(vhz(2:2:Emmmm,En,Epm)-vhz(4:2:Emm,En,Epm)))./vcoef.coefyboundFR(2:2:Emmmm);
        vhy(3:2:Emmm,En,1)=vhy(3:2:Emmm,En,Ep);
        vhy(3:2:Emmm,1,Ep)=vhy(3:2:Emmm,En,Ep);
        vhy(3:2:Emmm,1,1)=vhy(3:2:Emmm,En,Ep);
        
        
        
% %       %%%%%%%%%%%%%%  z vel  


        
%         %black even pgs
        vhz(2:2:Emm,3:2:Enmm,2:2:Epm)=(fhz(2:2:Emm,3:2:Enmm,2:2:Epm)+...
            vcoef.rescoefpp1(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhz(2:2:Emm,4:2:Enm,2:2:Epm)+vcoef.rescoefpm1(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhz(2:2:Emm,2:2:Enmmm,2:2:Epm)+...
            vcoef.rescoefpp2(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhz(3:2:Em,3:2:Enmm,2:2:Epm)+vcoef.rescoefpm2(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhz(1:2:Emmm,3:2:Enmm,2:2:Epm)+...
            2*vcoef.rescoefpp3(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhz(2:2:Emm,3:2:Enmm,3:2:Ep)+2*vcoef.rescoefpm3(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*vhz(2:2:Emm,3:2:Enmm,1:2:Epmm)+...
            vcoef.viscpp1(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*(vhx(2:2:Emm,4:2:Enm,3:2:Ep)-vhx(2:2:Emm,4:2:Enm,1:2:Epmm))+...
            vcoef.viscpm1(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*(vhx(2:2:Emm,2:2:Enmmm,1:2:Epmm)-vhx(2:2:Emm,2:2:Enmmm,3:2:Ep))...
            +vcoef.viscpp2(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*(vhy(3:2:Em,3:2:Enmm,3:2:Ep)-vhy(3:2:Em,3:2:Enmm,1:2:Epmm))+...
            vcoef.viscpm2(1:2:Emmm,2:2:Enmmm,1:2:Epmm).*(vhy(1:2:Emmm,3:2:Enmm,1:2:Epmm)-vhy(1:2:Emmm,3:2:Enmm,3:2:Ep))...
            )./vcoef.coefz(1:2:Emmm,2:2:Enmmm,1:2:Epmm);
        
        vhz(2:2:Emm,En,2:2:Epm)=(fhz(2:2:Emm,En,2:2:Epm)+...
           vcoef.rescoefpp1boundR(1:2:Emmm,1,1:2:Epmm).*vhz(2:2:Emm,2,2:2:Epm)+vcoef.rescoefpm1boundR(1:2:Emmm,1,1:2:Epmm).*vhz(2:2:Emm,Enm,2:2:Epm)+...
           vcoef.rescoefpp2boundR(1:2:Emmm,1,1:2:Epmm).*vhz(3:2:Em,En,2:2:Epm)+vcoef.rescoefpm2boundR(1:2:Emmm,1,1:2:Epmm).*vhz(1:2:Emmm,En,2:2:Epm)+...
           2*vcoef.rescoefpp3boundR(1:2:Emmm,1,1:2:Epmm).*vhz(2:2:Emm,En,3:2:Ep)+2*vcoef.rescoefpm3boundR(1:2:Emmm,1,1:2:Epmm).*vhz(2:2:Emm,En,1:2:Epmm)+...
           vcoef.viscpp1(1:2:Emmm,Enm,1:2:Epmm).*(vhx(2:2:Emm,2,3:2:Ep)-vhx(2:2:Emm,2,1:2:Epmm))+...
           vcoef.viscpm1(1:2:Emmm,Enm,1:2:Epmm).*(vhx(2:2:Emm,Enm,1:2:Epmm)-vhx(2:2:Emm,Enm,3:2:Ep))...
           +vcoef.viscpp2(1:2:Emmm,Enm,1:2:Epmm).*(vhy(3:2:Em,En,3:2:Ep)-vhy(3:2:Em,En,1:2:Epmm))+...
           vcoef.viscpm2(1:2:Emmm,Enm,1:2:Epmm).*(vhy(1:2:Emmm,En,1:2:Epmm)-vhy(1:2:Emmm,En,3:2:Ep))...
           )./vcoef.coefzboundR(1:2:Emmm,1,1:2:Epmm);
       vhz(2:2:Emm,1,2:2:Epm)=vhz(2:2:Emm,En,2:2:Epm);
        
        
        
        vhz(3:2:Emmm,2:2:Enm,2:2:Epm)=(fhz(3:2:Emmm,2:2:Enm,2:2:Epm)+...
            vcoef.rescoefpp1(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhz(3:2:Emmm,3:2:En,2:2:Epm)+vcoef.rescoefpm1(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhz(3:2:Emmm,1:2:Enmm,2:2:Epm)+...
            vcoef.rescoefpp2(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhz(4:2:Emm,2:2:Enm,2:2:Epm)+vcoef.rescoefpm2(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhz(2:2:Emmmm,2:2:Enm,2:2:Epm)+...
            2*vcoef.rescoefpp3(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhz(3:2:Emmm,2:2:Enm,3:2:Ep)+2*vcoef.rescoefpm3(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*vhz(3:2:Emmm,2:2:Enm,1:2:Epmm)+...
            vcoef.viscpp1(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*(vhx(3:2:Emmm,3:2:En,3:2:Ep)-vhx(3:2:Emmm,3:2:En,1:2:Epmm))+...
            vcoef.viscpm1(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*(vhx(3:2:Emmm,1:2:Enmm,1:2:Epmm)-vhx(3:2:Emmm,1:2:Enmm,3:2:Ep))...
            +vcoef.viscpp2(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*(vhy(4:2:Emm,2:2:Enm,3:2:Ep)-vhy(4:2:Emm,2:2:Enm,1:2:Epmm))+...
            vcoef.viscpm2(2:2:Emmmm,1:2:Enmm,1:2:Epmm).*(vhy(2:2:Emmmm,2:2:Enm,1:2:Epmm)-vhy(2:2:Emmmm,2:2:Enm,3:2:Ep))...
            )./vcoef.coefz(2:2:Emmmm,1:2:Enmm,1:2:Epmm);
        
%         %black odd pgs
        vhz(2:2:Emm,2:2:Enm,3:2:Epmm)=(fhz(2:2:Emm,2:2:Enm,3:2:Epmm)+...
            vcoef.rescoefpp1(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhz(2:2:Emm,3:2:En,3:2:Epmm)+vcoef.rescoefpm1(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhz(2:2:Emm,1:2:Enmm,3:2:Epmm)+...
            vcoef.rescoefpp2(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhz(3:2:Em,2:2:Enm,3:2:Epmm)+vcoef.rescoefpm2(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhz(1:2:Emmm,2:2:Enm,3:2:Epmm)+...
            2*vcoef.rescoefpp3(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhz(2:2:Emm,2:2:Enm,4:2:Epm)+2*vcoef.rescoefpm3(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*vhz(2:2:Emm,2:2:Enm,2:2:Epmmm)+...
            vcoef.viscpp1(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*(vhx(2:2:Emm,3:2:En,4:2:Epm)-vhx(2:2:Emm,3:2:En,2:2:Epmmm))+...
            vcoef.viscpm1(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*(vhx(2:2:Emm,1:2:Enmm,2:2:Epmmm)-vhx(2:2:Emm,1:2:Enmm,4:2:Epm))...
            +vcoef.viscpp2(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*(vhy(3:2:Em,2:2:Enm,4:2:Epm)-vhy(3:2:Em,2:2:Enm,2:2:Epmmm))+...
            vcoef.viscpm2(1:2:Emmm,1:2:Enmm,2:2:Epmmm).*(vhy(1:2:Emmm,2:2:Enm,2:2:Epmmm)-vhy(1:2:Emmm,2:2:Enm,4:2:Epm))...
            )./vcoef.coefz(1:2:Emmm,1:2:Enmm,2:2:Epmmm);
        
        vhz(2:2:Emm,2:2:Enm,Ep)=(fhz(2:2:Emm,2:2:Enm,Ep)+...
            vcoef.rescoefpp1boundF(1:2:Emmm,1:2:Enmm).*vhz(2:2:Emm,3:2:En,Ep)+vcoef.rescoefpm1boundF(1:2:Emmm,1:2:Enmm).*vhz(2:2:Emm,1:2:Enmm,Ep)+...
            vcoef.rescoefpp2boundF(1:2:Emmm,1:2:Enmm).*vhz(3:2:Em,2:2:Enm,Ep)+vcoef.rescoefpm2boundF(1:2:Emmm,1:2:Enmm).*vhz(1:2:Emmm,2:2:Enm,Ep)+...
            2*vcoef.rescoefpp3boundF(1:2:Emmm,1:2:Enmm).*vhz(2:2:Emm,2:2:Enm,2)+2*vcoef.rescoefpm3boundF(1:2:Emmm,1:2:Enmm).*vhz(2:2:Emm,2:2:Enm,Epm)+...
            vcoef.viscpp1(1:2:Emmm,1:2:Enmm,Epm).*(vhx(2:2:Emm,3:2:En,2)-vhx(2:2:Emm,3:2:En,Epm))+vcoef.viscpm1(1:2:Emmm,1:2:Enmm,Epm).*(vhx(2:2:Emm,1:2:Enmm,Epm)-vhx(2:2:Emm,1:2:Enmm,2))...
            +vcoef.viscpp2(1:2:Emmm,1:2:Enmm,Epm).*(vhy(3:2:Em,2:2:Enm,2)-vhy(3:2:Em,2:2:Enm,Epm))+vcoef.viscpm2(1:2:Emmm,1:2:Enmm,Epm).*(vhy(1:2:Emmm,2:2:Enm,Epm)-vhy(1:2:Emmm,2:2:Enm,2))...
            )./vcoef.coefzboundF(1:2:Emmm,1:2:Enmm);
        vhz(2:2:Emm,2:2:Enm,1)=vhz(2:2:Emm,2:2:Enm,Ep);
    
    
        vhz(3:2:Emmm,3:2:Enmm,3:2:Epmm)=(fhz(3:2:Emmm,3:2:Enmm,3:2:Epmm)+...
            vcoef.rescoefpp1(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhz(3:2:Emmm,4:2:Enm,3:2:Epmm)+vcoef.rescoefpm1(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhz(3:2:Emmm,2:2:Enmmm,3:2:Epmm)+...
            vcoef.rescoefpp2(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhz(4:2:Emm,3:2:Enmm,3:2:Epmm)+vcoef.rescoefpm2(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhz(2:2:Emmmm,3:2:Enmm,3:2:Epmm)+...
            2*vcoef.rescoefpp3(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhz(3:2:Emmm,3:2:Enmm,4:2:Epm)+2*vcoef.rescoefpm3(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*vhz(3:2:Emmm,3:2:Enmm,2:2:Epmmm)+...
            vcoef.viscpp1(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*(vhx(3:2:Emmm,4:2:Enm,4:2:Epm)-vhx(3:2:Emmm,4:2:Enm,2:2:Epmmm))+...
            vcoef.viscpm1(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*(vhx(3:2:Emmm,2:2:Enmmm,2:2:Epmmm)-vhx(3:2:Emmm,2:2:Enmmm,4:2:Epm))...
            +vcoef.viscpp2(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*(vhy(4:2:Emm,3:2:Enmm,4:2:Epm)-vhy(4:2:Emm,3:2:Enmm,2:2:Epmmm))+...
            vcoef.viscpm2(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm).*(vhy(2:2:Emmmm,3:2:Enmm,2:2:Epmmm)-vhy(2:2:Emmmm,3:2:Enmm,4:2:Epm))...
            )./vcoef.coefz(2:2:Emmmm,2:2:Enmmm,2:2:Epmmm);
        
        vhz(3:2:Emmm,En,3:2:Epmm)=(fhz(3:2:Emmm,En,3:2:Epmm)+...
            vcoef.rescoefpp1boundR(2:2:Emmmm,1,2:2:Epmmm).*vhz(3:2:Emmm,2,3:2:Epmm)+vcoef.rescoefpm1boundR(2:2:Emmmm,1,2:2:Epmmm).*vhz(3:2:Emmm,Enm,3:2:Epmm)+...
            vcoef.rescoefpp2boundR(2:2:Emmmm,1,2:2:Epmmm).*vhz(4:2:Emm,En,3:2:Epmm)+vcoef.rescoefpm2boundR(2:2:Emmmm,1,2:2:Epmmm).*vhz(2:2:Emmmm,En,3:2:Epmm)+...
            2*vcoef.rescoefpp3boundR(2:2:Emmmm,1,2:2:Epmmm).*vhz(3:2:Emmm,En,4:2:Epm)+2*vcoef.rescoefpm3boundR(2:2:Emmmm,1,2:2:Epmmm).*vhz(3:2:Emmm,En,2:2:Epmmm)+...
            vcoef.viscpp1(2:2:Emmmm,Enm,2:2:Epmmm).*(vhx(3:2:Emmm,2,4:2:Epm)-vhx(3:2:Emmm,2,2:2:Epmmm))+...
            vcoef.viscpm1(2:2:Emmmm,Enm,2:2:Epmmm).*(vhx(3:2:Emmm,Enm,2:2:Epmmm)-vhx(3:2:Emmm,Enm,4:2:Epm))...
            +vcoef.viscpp2(2:2:Emmmm,Enm,2:2:Epmmm).*(vhy(4:2:Emm,En,4:2:Epm)-vhy(4:2:Emm,En,2:2:Epmmm))+...
            vcoef.viscpm2(2:2:Emmmm,Enm,2:2:Epmmm).*(vhy(2:2:Emmmm,En,2:2:Epmmm)-vhy(2:2:Emmmm,En,4:2:Epm))...
            )./vcoef.coefzboundR(2:2:Emmmm,1,2:2:Epmmm);
        vhz(3:2:Emmm,1,3:2:Epmm)=vhz(3:2:Emmm,En,3:2:Epmm);
        
        vhz(3:2:Emmm,3:2:Enmm,Ep)=(fhz(3:2:Emmm,3:2:Enmm,Ep)+...
            vcoef.rescoefpp1boundF(2:2:Emmmm,2:2:Enmmm).*vhz(3:2:Emmm,4:2:Enm,Ep)+vcoef.rescoefpm1boundF(2:2:Emmmm,2:2:Enmmm).*vhz(3:2:Emmm,2:2:Enmmm,Ep)+...
            vcoef.rescoefpp2boundF(2:2:Emmmm,2:2:Enmmm).*vhz(4:2:Emm,3:2:Enmm,Ep)+vcoef.rescoefpm2boundF(2:2:Emmmm,2:2:Enmmm).*vhz(2:2:Emmmm,3:2:Enmm,Ep)+...
            2*vcoef.rescoefpp3boundF(2:2:Emmm,2:2:Enmm).*vhz(3:2:Emmm,3:2:Enmm,2)+2*vcoef.rescoefpm3boundF(2:2:Emmmm,2:2:Enmmm).*vhz(3:2:Emmm,3:2:Enmm,Epm)+...
            vcoef.viscpp1(2:2:Emmmm,2:2:Enmmm,Epm).*(vhx(3:2:Emmm,4:2:Enm,2)-vhx(3:2:Emmm,4:2:Enm,Epm))+vcoef.viscpm1(2:2:Emmmm,2:2:Enmmm,Epm).*(vhx(3:2:Emmm,2:2:Enmmm,Epm)-vhx(3:2:Emmm,2:2:Enmmm,2))...
            +vcoef.viscpp2(2:2:Emmmm,2:2:Enmmm,Epm).*(vhy(4:2:Emm,3:2:Enmm,2)-vhy(4:2:Emm,3:2:Enmm,Epm))+vcoef.viscpm2(2:2:Emmmm,2:2:Enmmm,Epm).*(vhy(2:2:Emmmm,3:2:Enmm,Epm)-vhy(2:2:Emmmm,3:2:Enmm,2))...
            )./vcoef.coefzboundF(2:2:Emmmm,2:2:Enmmm);
        vhz(3:2:Emmm,3:2:Enmm,1)=vhz(3:2:Emmm,3:2:Enmm,Ep);
            
            
        vhz(3:2:Emmm,En,Ep)=(fhz(3:2:Emmm,En,Ep)+...
           vcoef.rescoefpp1boundFR(2:2:Emmmm).*vhz(3:2:Emmm,2,Ep)+vcoef.rescoefpm1boundFR(2:2:Emmmm).*vhz(3:2:Emmm,Enm,Ep)+...
           vcoef.rescoefpp2boundFR(2:2:Emmmm).*vhz(4:2:Emm,En,Ep)+vcoef.rescoefpm2boundFR(2:2:Emmmm).*vhz(2:2:Emmmm,En,Ep)+...
           2*vcoef.rescoefpp3boundFR(2:2:Emmm).*vhz(3:2:Emmm,En,2)+2*vcoef.rescoefpm3boundFR(2:2:Emmmm).*vhz(3:2:Emmm,En,Epm)+...
           vcoef.viscpp1(2:2:Emmmm,Enm,Epm).*(vhx(3:2:Emmm,2,2)-vhx(3:2:Emmm,2,Epm))+vcoef.viscpm1(2:2:Emmmm,Enm,Epm).*(vhx(3:2:Emmm,Enm,Epm)-vhx(3:2:Emmm,Enm,2))...
           +vcoef.viscpp2(2:2:Emmmm,Enm,Epm).*(vhy(4:2:Emm,En,2)-vhy(4:2:Emm,En,Epm))+vcoef.viscpm2(2:2:Emmmm,Enm,Epm).*(vhy(2:2:Emmmm,En,Epm)-vhy(2:2:Emmmm,En,2))...
           )./vcoef.coefzboundFR(2:2:Emmmm);
           vhz(3:2:Emmm,1,1)=vhz(3:2:Emmm,En,Ep);   
           vhz(3:2:Emmm,En,1)=vhz(3:2:Emmm,En,Ep);   
           vhz(3:2:Emmm,1,Ep)=vhz(3:2:Emmm,En,Ep);   
%          
%         

        
        
%         vh(:,:,Ep)=vh(:,:,Ep-1);
        
        
    %     vh(:,1)=vh(:,2);
    %     vh(:,1)=vh(:,Enm);
    %     vh(:,En)=vh(:,2);
    
%         vh=(1-w)*vhnew+w*vh;
%         vhnew=vh;
    end

% vhnew=vh;



